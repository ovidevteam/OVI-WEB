import{_ as Ee,r as v,a as q,z as be,B as ye,c as C,b as s,d as t,w as a,s as Ce,x as d,W as Ne,A as h,X as g,ay as ke,Z as Pe,f as xe,D as we,g as De,o as u,j as p,I as Se,G as Oe,H as Te,as as Le,az as Me,aA as Ve,N as Ie,p as i,O as j,Q as Re,P as Ge,R as K,S as Q,q as Fe,e as Ae,ak as Be,ac as ze,an as He,ap as Ue,aw as We,E as qe,h as je,i as Ke,ag as Qe,aB as Xe,a9 as $e,aC as Je,ax as Ze,aj as Ye,J as X,K as $,al as et,aD as tt,aE as at,y as S}from"./index-CEoFeFsB.js";/* empty css                   *//* empty css                         *//* empty css                  *//* empty css                    *//* empty css                       *//* empty css                             *//* empty css                 *//* empty css                        *//* empty css                    *//* empty css               *//* empty css                    */import{f as I}from"./feedbackService-DQNK-YXO.js";const st={class:"my-feedbacks"},nt={class:"stats-grid"},lt={class:"stat-card danger"},ot={class:"stat-icon"},it={class:"stat-content"},dt={class:"stat-value"},ut={class:"stat-card warning"},ct={class:"stat-icon"},rt={class:"stat-content"},pt={class:"stat-value"},mt={class:"stat-card success"},_t={class:"stat-icon"},ht={class:"stat-content"},vt={class:"stat-value"},gt={class:"stat-card",style:{"border-left-color":"#F56C6C"}},ft={class:"stat-icon",style:{background:"rgba(245, 108, 108, 0.1)",color:"#F56C6C"}},Et={class:"stat-content"},bt={class:"stat-value"},yt={class:"content-card"},Ct={class:"date-cell"},Nt={class:"content-cell"},kt={key:0,class:"process-content"},Pt={class:"feedback-info-section"},xt={class:"section-title"},wt={key:0,class:"process-form-section"},Dt={class:"section-title"},St={class:"upload-dragger"},Ot={class:"process-history-section"},Tt={class:"section-title"},Lt={class:"timeline-content"},Mt={class:"timeline-header"},Vt={class:"handler-name"},It={class:"timeline-text"},Rt={key:0,class:"timeline-attachments"},Gt={__name:"MyFeedbacks",setup(Ft){De();const k=v(!1),O=v(!1),T=v("pending"),c=v([]),E=v(!1),r=v(null),L=v(null),f=v([]),o=q({processContent:"",newStatus:"PROCESSING",note:"",attachments:[]}),J={processContent:[{required:!0,message:"Vui lòng nhập nội dung xử lý",trigger:"blur"}],newStatus:[{required:!0,message:"Vui lòng chọn trạng thái",trigger:"change"}]},_=q({pending:0,processing:0,completed:0,overdue:0}),R=be(()=>{switch(T.value){case"pending":return c.value.filter(n=>n.status==="NEW");case"processing":return c.value.filter(n=>n.status==="PROCESSING");case"completed":return c.value.filter(n=>n.status==="COMPLETED");case"overdue":return c.value.filter(n=>n.isOverdue&&n.status!=="COMPLETED");default:return c.value}}),Z=async()=>{k.value=!0;try{c.value=await I.getMyFeedbacks()}catch{c.value=[{id:1,code:"PA-20251127-001",receivedDate:"2025-11-27",content:"Phản ánh về thái độ phục vụ của nhân viên khoa Nội",departmentName:"Nội khoa",level:"HIGH",status:"NEW",isOverdue:!1},{id:2,code:"PA-20251124-005",receivedDate:"2025-11-24",content:"Thời gian chờ khám quá lâu tại phòng khám da liễu",departmentName:"Da liễu",level:"CRITICAL",status:"NEW",isOverdue:!0},{id:3,code:"PA-20251126-003",receivedDate:"2025-11-26",content:"Cơ sở vật chất phòng khám cần được nâng cấp",departmentName:"Ngoại khoa",level:"MEDIUM",status:"PROCESSING",isOverdue:!1},{id:4,code:"PA-20251120-002",receivedDate:"2025-11-20",content:"Khen ngợi bác sĩ khoa Ngoại điều trị nhiệt tình",departmentName:"Ngoại khoa",level:"LOW",status:"COMPLETED",isOverdue:!1}]}finally{k.value=!1,M()}},M=()=>{_.pending=c.value.filter(n=>n.status==="NEW").length,_.processing=c.value.filter(n=>n.status==="PROCESSING").length,_.completed=c.value.filter(n=>n.status==="COMPLETED").length,_.overdue=c.value.filter(n=>n.isOverdue&&n.status!=="COMPLETED").length},Y=()=>{},ee=n=>{G(n)},G=async n=>{r.value={...n},E.value=!0;try{f.value=await I.getProcessHistory(n.id)}catch{n.status==="PROCESSING"?f.value=[{timestamp:"27/11/2025 10:30",handlerName:"Nguyễn Văn A",status:"PROCESSING",content:"Đã tiếp nhận phản ánh và đang liên hệ phòng ban liên quan để xác minh.",attachments:[]}]:n.status==="COMPLETED"?f.value=[{timestamp:"20/11/2025 09:00",handlerName:"Admin",status:"NEW",content:"Tiếp nhận phản ánh từ khách hàng.",attachments:[]},{timestamp:"21/11/2025 14:30",handlerName:"Nguyễn Văn A",status:"PROCESSING",content:"Đã liên hệ phòng ban và xác minh thông tin phản ánh.",attachments:[]},{timestamp:"22/11/2025 16:00",handlerName:"Nguyễn Văn A",status:"COMPLETED",content:"Đã xử lý xong. Phản ánh được ghi nhận và chuyển đến lãnh đạo phòng ban.",attachments:[{name:"bien_ban_xu_ly.pdf"}]}]:f.value=[]}},te=()=>{o.processContent="",o.newStatus="PROCESSING",o.note="",o.attachments=[],r.value=null,f.value=[]},ae=async()=>{L.value&&await L.value.validate(async n=>{if(n){O.value=!0;try{await I.updateProcessing(r.value.id,{content:o.processContent,status:o.newStatus,note:o.note,attachments:o.attachments});const e=c.value.findIndex(m=>m.id===r.value.id);e!==-1&&(c.value[e].status=o.newStatus),M(),S.success("Cập nhật xử lý thành công!"),E.value=!1}catch{const m=c.value.findIndex(P=>P.id===r.value.id);m!==-1&&(c.value[m].status=o.newStatus),M(),S.success("Cập nhật xử lý thành công! (Demo)"),E.value=!1}finally{O.value=!1}}})},F=n=>{switch(n){case"COMPLETED":return"success";case"PROCESSING":return"warning";case"NEW":return"primary";default:return"info"}},se=n=>{switch(n){case"COMPLETED":return"Hoàn thành";case"PROCESSING":return"Đang xử lý";case"NEW":return"Tiếp nhận";default:return n}},ne=n=>{S.warning(`Chỉ được upload tối đa 5 file. Bạn đã chọn ${n.length} file.`)},le=(n,e)=>{console.log("File removed:",n.name)},oe=n=>n.size/1024/1024<5?!0:(S.error("File không được vượt quá 5MB!"),!1);return ye(()=>{Z()}),(n,e)=>{var H;const m=Ce,P=Ve,x=Me,ie=ke,b=Ie,y=Re,de=Ge,V=Fe,ue=we,A=Be,N=Ue,ce=He,B=Ke,w=je,z=Xe,re=Qe,pe=$e,me=qe,_e=tt,he=et,ve=Ye,ge=xe,fe=Pe;return u(),C("div",st,[s("div",nt,[s("div",lt,[s("div",ot,[t(m,null,{default:a(()=>[t(p(Se))]),_:1})]),s("div",it,[s("div",dt,d(_.pending),1),e[7]||(e[7]=s("div",{class:"stat-label"},"Chờ xử lý",-1))])]),s("div",ut,[s("div",ct,[t(m,null,{default:a(()=>[t(p(Oe))]),_:1})]),s("div",rt,[s("div",pt,d(_.processing),1),e[8]||(e[8]=s("div",{class:"stat-label"},"Đang xử lý",-1))])]),s("div",mt,[s("div",_t,[t(m,null,{default:a(()=>[t(p(Te))]),_:1})]),s("div",ht,[s("div",vt,d(_.completed),1),e[9]||(e[9]=s("div",{class:"stat-label"},"Hoàn thành",-1))])]),s("div",gt,[s("div",ft,[t(m,null,{default:a(()=>[t(p(Le))]),_:1})]),s("div",Et,[s("div",bt,d(_.overdue),1),e[10]||(e[10]=s("div",{class:"stat-label"},"Quá hạn",-1))])])]),s("div",yt,[t(ie,{modelValue:T.value,"onUpdate:modelValue":e[0]||(e[0]=l=>T.value=l),onTabChange:Y},{default:a(()=>[t(x,{name:"pending"},{label:a(()=>[e[11]||(e[11]=s("span",null,"Chờ xử lý",-1)),_.pending>0?(u(),h(P,{key:0,value:_.pending,class:"tab-badge"},null,8,["value"])):g("",!0)]),_:1}),t(x,{label:"Đang xử lý",name:"processing"}),t(x,{label:"Hoàn thành",name:"completed"}),t(x,{name:"overdue"},{label:a(()=>[e[12]||(e[12]=s("span",{class:"text-danger"},"Quá hạn",-1)),_.overdue>0?(u(),h(P,{key:0,value:_.overdue,class:"tab-badge",type:"danger"},null,8,["value"])):g("",!0)]),_:1})]),_:1},8,["modelValue"]),Ne((u(),h(ue,{data:R.value,stripe:"",style:{width:"100%"},onRowClick:ee},{default:a(()=>[t(b,{prop:"code",label:"Số PA",width:"145"}),t(b,{prop:"receivedDate",label:"Ngày nhận",width:"115"},{default:a(({row:l})=>[s("div",Ct,[i(d(p(j)(l.receivedDate))+" ",1),l.isOverdue?(u(),h(y,{key:0,type:"danger",size:"small",effect:"dark",class:"overdue-tag"},{default:a(()=>[...e[13]||(e[13]=[i(" Quá hạn ",-1)])]),_:1})):g("",!0)])]),_:1}),t(b,{prop:"content",label:"Nội dung","min-width":"220"},{default:a(({row:l})=>[t(de,{content:l.content,placement:"top","show-after":500},{default:a(()=>[s("span",Nt,d(l.content),1)]),_:2},1032,["content"])]),_:1}),t(b,{prop:"departmentName",label:"Phòng ban","min-width":"110"}),t(b,{prop:"level",label:"Mức độ",width:"95",align:"center"},{default:a(({row:l})=>[t(y,{type:p(K)(l.level),size:"small"},{default:a(()=>[i(d(p(Q)(l.level)),1)]),_:2},1032,["type"])]),_:1}),t(b,{label:"",width:"90",align:"center"},{default:a(({row:l})=>[t(V,{type:"primary",onClick:Ae(D=>G(l),["stop"])},{default:a(()=>[i(d(l.status==="COMPLETED"?"Xem":"Xử lý"),1)]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[fe,k.value]]),R.value.length===0&&!k.value?(u(),h(A,{key:0,description:"Không có phản ánh nào"})):g("",!0)]),t(ge,{modelValue:E.value,"onUpdate:modelValue":e[6]||(e[6]=l=>E.value=l),title:((H=r.value)==null?void 0:H.status)==="COMPLETED"?"Chi tiết xử lý":"Xử lý Phản ánh",width:"1000px",top:"3vh",draggable:"",class:"process-dialog",onClose:te},{footer:a(()=>{var l;return[t(V,{onClick:e[5]||(e[5]=D=>E.value=!1)},{default:a(()=>[...e[21]||(e[21]=[i("Đóng",-1)])]),_:1}),((l=r.value)==null?void 0:l.status)!=="COMPLETED"?(u(),h(V,{key:0,type:"primary",loading:O.value,onClick:ae},{default:a(()=>[...e[22]||(e[22]=[i(" Lưu xử lý ",-1)])]),_:1},8,["loading"])):g("",!0)]}),default:a(()=>[r.value?(u(),C("div",kt,[s("div",Pt,[s("h4",xt,[t(m,null,{default:a(()=>[t(p(ze))]),_:1}),e[14]||(e[14]=i(" Thông tin Phản ánh ",-1))]),t(ce,{column:2,border:""},{default:a(()=>[t(N,{label:"Mã PA"},{default:a(()=>[s("strong",null,d(r.value.code),1)]),_:1}),t(N,{label:"Ngày nhận"},{default:a(()=>[i(d(p(j)(r.value.receivedDate)),1)]),_:1}),t(N,{label:"Phòng ban"},{default:a(()=>[i(d(r.value.departmentName),1)]),_:1}),t(N,{label:"Mức độ"},{default:a(()=>[t(y,{type:p(K)(r.value.level),size:"small"},{default:a(()=>[i(d(p(Q)(r.value.level)),1)]),_:1},8,["type"])]),_:1}),t(N,{label:"Nội dung",span:2},{default:a(()=>[i(d(r.value.content),1)]),_:1})]),_:1})]),r.value.status!=="COMPLETED"?(u(),C("div",wt,[s("h4",Dt,[t(m,null,{default:a(()=>[t(p(We))]),_:1}),e[15]||(e[15]=i(" Ghi nhận xử lý ",-1))]),t(me,{model:o,ref_key:"processFormRef",ref:L,rules:J,"label-width":"140px"},{default:a(()=>[t(w,{label:"Nội dung xử lý",prop:"processContent"},{default:a(()=>[t(B,{type:"textarea",rows:4,modelValue:o.processContent,"onUpdate:modelValue":e[1]||(e[1]=l=>o.processContent=l),placeholder:"Nhập nội dung xử lý chi tiết...",maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(w,{label:"Trạng thái",prop:"newStatus"},{default:a(()=>[t(re,{modelValue:o.newStatus,"onUpdate:modelValue":e[2]||(e[2]=l=>o.newStatus=l)},{default:a(()=>[t(z,{value:"PROCESSING"},{default:a(()=>[t(y,{type:"warning",size:"small"},{default:a(()=>[...e[16]||(e[16]=[i("Đang xử lý",-1)])]),_:1})]),_:1}),t(z,{value:"COMPLETED"},{default:a(()=>[t(y,{type:"success",size:"small"},{default:a(()=>[...e[17]||(e[17]=[i("Hoàn thành",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"Ghi chú"},{default:a(()=>[t(B,{type:"textarea",rows:2,modelValue:o.note,"onUpdate:modelValue":e[3]||(e[3]=l=>o.note=l),placeholder:"Ghi chú thêm (nếu có)..."},null,8,["modelValue"])]),_:1}),t(w,{label:"File đính kèm"},{default:a(()=>[t(pe,{"file-list":o.attachments,"onUpdate:fileList":e[4]||(e[4]=l=>o.attachments=l),class:"upload-area",action:"#","auto-upload":!1,limit:5,"on-exceed":ne,"on-remove":le,"before-upload":oe,accept:".jpg,.jpeg,.png,.pdf,.doc,.docx",multiple:"",drag:""},{tip:a(()=>[...e[19]||(e[19]=[s("div",{class:"el-upload__tip"}," Hỗ trợ: JPG, PNG, PDF, DOC (tối đa 5 file, mỗi file ≤ 5MB) ",-1)])]),default:a(()=>[s("div",St,[t(m,{class:"upload-icon"},{default:a(()=>[t(p(Je))]),_:1}),e[18]||(e[18]=s("div",{class:"upload-text"},[i(" Kéo thả file vào đây hoặc "),s("em",null,"click để chọn")],-1))])]),_:1},8,["file-list"])]),_:1})]),_:1},8,["model"])])):g("",!0),s("div",Ot,[s("h4",Tt,[t(m,null,{default:a(()=>[t(p(Ze))]),_:1}),e[20]||(e[20]=i(" Lịch sử xử lý ",-1))]),f.value.length>0?(u(),h(ve,{key:0},{default:a(()=>[(u(!0),C(X,null,$(f.value,(l,D)=>(u(),h(he,{key:D,timestamp:l.timestamp,type:F(l.status),hollow:D!==0,placement:"top"},{default:a(()=>{var U;return[s("div",Lt,[s("div",Mt,[s("span",Vt,d(l.handlerName),1),t(y,{type:F(l.status),size:"small"},{default:a(()=>[i(d(se(l.status)),1)]),_:2},1032,["type"])]),s("p",It,d(l.content),1),((U=l.attachments)==null?void 0:U.length)>0?(u(),C("div",Rt,[(u(!0),C(X,null,$(l.attachments,W=>(u(),h(_e,{key:W.name,type:"primary",icon:p(at)},{default:a(()=>[i(d(W.name),1)]),_:2},1032,["icon"]))),128))])):g("",!0)])]}),_:2},1032,["timestamp","type","hollow"]))),128))]),_:1})):(u(),h(A,{key:1,description:"Chưa có lịch sử xử lý","image-size":80}))])])):g("",!0)]),_:1},8,["modelValue","title"])])}}},Zt=Ee(Gt,[["__scopeId","data-v-17970108"]]);export{Zt as default};
