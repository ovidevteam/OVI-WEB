import{r as d,a as q,z,B as Q,c as T,b as N,d as l,W as X,w as t,j as G,Y as J,q as K,Z as W,A as C,f as Y,D as Z,o as r,p as i,N as ee,Q as ae,x as le,E as te,h as ne,i as oe,C as ie,J as S,K as A,L as se,ag as de,aB as ue,aL as re,y as k}from"./index-CEoFeFsB.js";/* empty css                   *//* empty css                       *//* empty css               *//* empty css                  *//* empty css                        *//* empty css                    */import{d as g}from"./departmentService-GW46A7lu.js";import{u as me}from"./userService-D7v_MQuW.js";const pe={class:"department-management"},fe={class:"content-card"},ge={class:"content-card-header"},Ce={__name:"DepartmentManagement",setup(ce){const c=d(!1),v=d(!1),h=d([]),m=d([]),_=d([]),p=d(!1),V=d(null),n=q({id:null,code:"",name:"",managerId:null,defaultHandlerId:null,notificationEmail:"",status:"ACTIVE"}),b=z(()=>!!n.id),H={name:[{required:!0,message:"Vui lòng nhập tên phòng",trigger:"blur"}],notificationEmail:[{type:"email",message:"Email không hợp lệ",trigger:"blur"}]},E=async()=>{c.value=!0;try{h.value=await g.getList()}catch{h.value=[{id:1,code:"PB-001",name:"Nội khoa",managerName:"BS. Nguyễn Văn A",defaultHandlerName:"BS. Nguyễn Văn A",notificationEmail:"noikhoa@bvyhanoi.vn",status:"ACTIVE"},{id:2,code:"PB-002",name:"Ngoại khoa",managerName:"BS. Trần Văn B",defaultHandlerName:"BS. Trần Văn B",notificationEmail:"ngoaikhoa@bvyhanoi.vn",status:"ACTIVE"},{id:3,code:"PB-003",name:"Sản khoa",managerName:"BS. Lê Thị C",defaultHandlerName:"BS. Lê Thị C",notificationEmail:"sankhoa@bvyhanoi.vn",status:"ACTIVE"}]}finally{c.value=!1}},L=async()=>{try{const o=await me.getList();m.value=o.data||[],_.value=m.value.filter(e=>e.role==="HANDLER")}catch{m.value=[{id:1,fullName:"BS. Nguyễn Văn A"},{id:2,fullName:"BS. Trần Văn B"}],_.value=m.value}},B=(o=null)=>{o?Object.assign(n,o):Object.assign(n,{id:null,code:"",name:"",managerId:null,defaultHandlerId:null,notificationEmail:"",status:"ACTIVE"}),p.value=!0},D=async()=>{if(V.value)try{await V.value.validate(),v.value=!0,b.value?await g.update(n.id,n):await g.create(n),k.success(b.value?"Cập nhật thành công!":"Thêm mới thành công!"),p.value=!1,E()}catch(o){o!==!1&&k.error("Có lỗi xảy ra")}finally{v.value=!1}},U=async o=>{try{await re.confirm(`Bạn có chắc chắn muốn xóa phòng "${o.name}"?`,"Xác nhận xóa",{type:"warning"}),await g.delete(o.id),k.success("Đã xóa phòng ban!"),E()}catch{}};return Q(()=>{E(),L()}),(o,e)=>{const f=K,s=ee,M=ae,P=Z,y=oe,u=ne,I=se,w=ie,x=ue,R=de,$=te,j=Y,F=W;return r(),T("div",pe,[N("div",fe,[N("div",ge,[e[10]||(e[10]=N("h3",{class:"content-card-title"},"Quản lý Phòng ban",-1)),l(f,{type:"primary",icon:G(J),onClick:e[0]||(e[0]=a=>B())},{default:t(()=>[...e[9]||(e[9]=[i(" Thêm mới ",-1)])]),_:1},8,["icon"])]),X((r(),C(P,{data:h.value,stripe:""},{default:t(()=>[l(s,{prop:"code",label:"Mã phòng",width:"120"}),l(s,{prop:"name",label:"Tên phòng","min-width":"200"}),l(s,{prop:"managerName",label:"Trưởng phòng",width:"180"}),l(s,{prop:"defaultHandlerName",label:"Người xử lý mặc định",width:"180"}),l(s,{prop:"notificationEmail",label:"Email thông báo","min-width":"200"}),l(s,{prop:"status",label:"Trạng thái",width:"120",align:"center"},{default:t(({row:a})=>[l(M,{type:a.status==="ACTIVE"?"success":"info",size:"small"},{default:t(()=>[i(le(a.status==="ACTIVE"?"Hoạt động":"Ngừng"),1)]),_:2},1032,["type"])]),_:1}),l(s,{label:"Thao tác",width:"150",align:"center",fixed:"right"},{default:t(({row:a})=>[l(f,{type:"primary",link:"",onClick:O=>B(a)},{default:t(()=>[...e[11]||(e[11]=[i("Sửa",-1)])]),_:1},8,["onClick"]),l(f,{type:"danger",link:"",onClick:O=>U(a)},{default:t(()=>[...e[12]||(e[12]=[i("Xóa",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[F,c.value]])]),l(j,{modelValue:p.value,"onUpdate:modelValue":e[8]||(e[8]=a=>p.value=a),title:b.value?"Sửa Phòng ban":"Thêm Phòng ban",width:"500px","close-on-click-modal":!1},{footer:t(()=>[l(f,{onClick:e[7]||(e[7]=a=>p.value=!1)},{default:t(()=>[...e[15]||(e[15]=[i("Hủy",-1)])]),_:1}),l(f,{type:"primary",loading:v.value,onClick:D},{default:t(()=>[...e[16]||(e[16]=[i("Lưu",-1)])]),_:1},8,["loading"])]),default:t(()=>[l($,{ref_key:"formRef",ref:V,model:n,rules:H,"label-width":"150px"},{default:t(()=>[l(u,{label:"Mã phòng",prop:"code"},{default:t(()=>[l(y,{modelValue:n.code,"onUpdate:modelValue":e[1]||(e[1]=a=>n.code=a),placeholder:"Tự động nếu để trống"},null,8,["modelValue"])]),_:1}),l(u,{label:"Tên phòng",prop:"name"},{default:t(()=>[l(y,{modelValue:n.name,"onUpdate:modelValue":e[2]||(e[2]=a=>n.name=a)},null,8,["modelValue"])]),_:1}),l(u,{label:"Trưởng phòng"},{default:t(()=>[l(w,{modelValue:n.managerId,"onUpdate:modelValue":e[3]||(e[3]=a=>n.managerId=a),placeholder:"Chọn trưởng phòng",clearable:"",style:{width:"100%"}},{default:t(()=>[(r(!0),T(S,null,A(m.value,a=>(r(),C(I,{key:a.id,label:a.fullName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"Người xử lý mặc định"},{default:t(()=>[l(w,{modelValue:n.defaultHandlerId,"onUpdate:modelValue":e[4]||(e[4]=a=>n.defaultHandlerId=a),placeholder:"Chọn người xử lý",clearable:"",style:{width:"100%"}},{default:t(()=>[(r(!0),T(S,null,A(_.value,a=>(r(),C(I,{key:a.id,label:a.fullName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"Email thông báo",prop:"notificationEmail"},{default:t(()=>[l(y,{modelValue:n.notificationEmail,"onUpdate:modelValue":e[5]||(e[5]=a=>n.notificationEmail=a),type:"email"},null,8,["modelValue"])]),_:1}),l(u,{label:"Trạng thái"},{default:t(()=>[l(R,{modelValue:n.status,"onUpdate:modelValue":e[6]||(e[6]=a=>n.status=a)},{default:t(()=>[l(x,{value:"ACTIVE"},{default:t(()=>[...e[13]||(e[13]=[i("Hoạt động",-1)])]),_:1}),l(x,{value:"INACTIVE"},{default:t(()=>[...e[14]||(e[14]=[i("Ngừng",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}};export{Ce as default};
