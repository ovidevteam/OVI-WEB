import{_ as pt,u as _t,r as h,a as j,C as vt,c as T,b as n,d as e,w as o,ai as ft,s as yt,x as d,a1 as bt,a4 as Nt,B as D,a6 as Tt,f as kt,y as H,G as xt,o as p,aj as Bt,F as Vt,R as St,P as G,Q as K,a7 as It,q as Dt,j as v,aa as Rt,p as _,av as wt,aw as $,ax as Ct,N as Et,ay as Pt,T as At,V as Ht,az as Lt,W as zt,aA as Ft,e as qt,aB as Mt,a2 as Q,aC as Xt,ao as Ut,aq as Ot,E as jt,h as Gt,i as Kt}from"./index-WXSJfKjD.js";/* empty css                   *//* empty css                         *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                        *//* empty css                    *//* empty css                *//* empty css               *//* empty css                             */const $t={class:"feedback-ratings"},Qt={class:"content-card filter-card"},Wt={class:"stats-grid"},Jt={class:"stat-card"},Yt={class:"stat-icon total"},Zt={class:"stat-info"},tn={class:"stat-value"},nn={class:"stat-card"},en={class:"stat-icon pending"},an={class:"stat-info"},on={class:"stat-value"},sn={class:"stat-card"},ln={class:"stat-icon rated"},dn={class:"stat-info"},cn={class:"stat-value"},rn={class:"stat-card"},hn={class:"stat-icon avg"},gn={class:"stat-info"},un={class:"stat-value"},mn={class:"content-card"},pn={class:"content-text"},_n={class:"doctor-cell"},vn={class:"doctor-name-text"},fn={key:1,class:"no-rating"},yn={class:"pagination-wrapper"},bn={key:0,class:"rating-dialog-content"},Nn={class:"feedback-info-section"},Tn={class:"feedback-info-grid"},kn={class:"info-item"},xn={class:"info-value"},Bn={class:"info-item"},Vn={class:"info-value"},Sn={class:"info-item full-width"},In={class:"info-value"},Dn={class:"doctor-info-section"},Rn={class:"doctor-profile"},wn={class:"doctor-profile-info"},Cn={class:"doctor-name"},En={class:"doctor-dept"},Pn={key:0,class:"process-history-section"},An={class:"section-title"},Hn={class:"timeline-content"},Ln={class:"timeline-header"},zn={class:"timeline-handler"},Fn={class:"timeline-note"},qn={class:"rating-form-section"},Mn={class:"rating-stars"},Xn={__name:"FeedbackRatings",setup(Un){_t();const R=h(!1),w=h(!1),k=h([]),L=h(0),C=h(1),E=h(10),x=h(null),B=h(null),P=h([]),z=h([]),g=j({total:0,pending:0,rated:0,avgRating:0}),V=h(!1),c=h(null),A=h(null),u=j({rating:0,comment:""}),W={rating:[{required:!0,message:"Vui lòng chọn số sao đánh giá",trigger:"change"},{type:"number",min:1,max:5,message:"Đánh giá từ 1-5 sao",trigger:"change"}]},m=[{id:1,code:"PA-2024-001",content:"Thời gian chờ khám quá lâu, bệnh nhân phải đợi hơn 2 tiếng",doctorId:101,doctorName:"BS. Nguyễn Văn A",departmentId:1,departmentName:"Nội khoa",completedDate:"20/11/2024",rating:4,comment:"Bác sĩ xử lý tốt, giải quyết nhanh chóng",processHistory:[{date:"18/11/2024 08:30",handler:"Nguyễn Văn Tiếp Nhận",action:"Tiếp nhận",note:"Tiếp nhận phản ánh từ hotline, chuyển phòng Nội khoa xử lý"},{date:"18/11/2024 14:00",handler:"BS. Nguyễn Văn A",action:"Đang xử lý",note:"Đã xác minh tình trạng, đang điều phối lại lịch khám"},{date:"19/11/2024 09:15",handler:"BS. Nguyễn Văn A",action:"Xử lý xong",note:"Đã tăng cường nhân viên, giảm thời gian chờ. Liên hệ bệnh nhân xin lỗi và hẹn khám lại miễn phí"},{date:"20/11/2024 10:00",handler:"Trưởng khoa Nội",action:"Hoàn thành",note:"Xác nhận đã xử lý xong, bệnh nhân hài lòng"}]},{id:2,code:"PA-2024-002",content:"Nhân viên lễ tân thiếu thân thiện với bệnh nhân ca sáng",doctorId:102,doctorName:"BS. Trần Thị B",departmentId:2,departmentName:"Ngoại khoa",completedDate:"21/11/2024",rating:null,comment:null,processHistory:[{date:"19/11/2024 10:00",handler:"Trần Thị Tiếp Nhận",action:"Tiếp nhận",note:"Tiếp nhận từ hộp thư góp ý"},{date:"19/11/2024 15:30",handler:"BS. Trần Thị B",action:"Đang xử lý",note:"Xác nhận sự việc, đã làm việc với nhân viên liên quan"},{date:"21/11/2024 08:00",handler:"BS. Trần Thị B",action:"Hoàn thành",note:"Đã nhắc nhở nhân viên, bổ sung đào tạo kỹ năng giao tiếp"}]},{id:3,code:"PA-2024-003",content:"Khen ngợi bác sĩ điều trị nhiệt tình, chuyên nghiệp",doctorId:103,doctorName:"BS. Lê Văn C",departmentId:3,departmentName:"Da liễu",completedDate:"22/11/2024",rating:5,comment:"Xuất sắc!",processHistory:[{date:"21/11/2024 14:00",handler:"Lê Văn Tiếp Nhận",action:"Tiếp nhận",note:"Tiếp nhận lời khen từ bệnh nhân qua hotline"},{date:"22/11/2024 09:00",handler:"BS. Lê Văn C",action:"Hoàn thành",note:"Cảm ơn phản hồi tích cực. Đã ghi nhận vào hồ sơ thi đua"}]},{id:4,code:"PA-2024-004",content:"Phòng khám thiếu sạch sẽ, cần cải thiện vệ sinh",doctorId:104,doctorName:"BS. Phạm Thị D",departmentId:4,departmentName:"Sản khoa",completedDate:"23/11/2024",rating:null,comment:null,processHistory:[{date:"21/11/2024 16:00",handler:"Phạm Văn Tiếp Nhận",action:"Tiếp nhận",note:"Tiếp nhận phản ánh trực tiếp tại quầy"},{date:"22/11/2024 08:00",handler:"BS. Phạm Thị D",action:"Đang xử lý",note:"Đã kiểm tra thực tế, phối hợp bộ phận vệ sinh"},{date:"22/11/2024 17:00",handler:"BS. Phạm Thị D",action:"Xử lý xong",note:"Đã vệ sinh toàn bộ khu vực, tăng tần suất dọn dẹp"},{date:"23/11/2024 09:00",handler:"Trưởng khoa Sản",action:"Hoàn thành",note:"Đã nghiệm thu, đạt yêu cầu"}]},{id:5,code:"PA-2024-005",content:"Cơ sở vật chất xuống cấp, máy lạnh không hoạt động",doctorId:105,doctorName:"BS. Hoàng Văn E",departmentId:5,departmentName:"Nhi khoa",completedDate:"24/11/2024",rating:3,comment:"Xử lý ổn",processHistory:[{date:"22/11/2024 09:00",handler:"Hoàng Văn Tiếp Nhận",action:"Tiếp nhận",note:"Tiếp nhận phản ánh qua email"},{date:"22/11/2024 14:00",handler:"BS. Hoàng Văn E",action:"Đang xử lý",note:"Đã báo cáo phòng kỹ thuật, đợi sửa chữa"},{date:"24/11/2024 11:00",handler:"BS. Hoàng Văn E",action:"Hoàn thành",note:"Máy lạnh đã được sửa chữa và hoạt động bình thường"}]},{id:6,code:"PA-2024-006",content:"Thái độ phục vụ của y tá chưa tốt trong giờ trưa",doctorId:101,doctorName:"BS. Nguyễn Văn A",departmentId:1,departmentName:"Nội khoa",completedDate:"25/11/2024",rating:null,comment:null,processHistory:[{date:"23/11/2024 13:30",handler:"Nguyễn Thị Tiếp Nhận",action:"Tiếp nhận",note:"Tiếp nhận từ hotline"},{date:"24/11/2024 08:00",handler:"BS. Nguyễn Văn A",action:"Đang xử lý",note:"Đã xác minh với y tá ca trực, ghi nhận sự việc"},{date:"25/11/2024 09:00",handler:"BS. Nguyễn Văn A",action:"Hoàn thành",note:"Đã nhắc nhở và yêu cầu y tá viết bản kiểm điểm"}]},{id:7,code:"PA-2024-007",content:"Bác sĩ giải thích rõ ràng về tình trạng bệnh và phác đồ điều trị",doctorId:102,doctorName:"BS. Trần Thị B",departmentId:2,departmentName:"Ngoại khoa",completedDate:"26/11/2024",rating:5,comment:"Rất hài lòng với cách giải thích của bác sĩ",processHistory:[{date:"25/11/2024 10:00",handler:"Trần Văn Tiếp Nhận",action:"Tiếp nhận",note:"Tiếp nhận lời khen từ bệnh nhân"},{date:"26/11/2024 08:00",handler:"BS. Trần Thị B",action:"Hoàn thành",note:"Cảm ơn phản hồi. Ghi nhận thành tích"}]},{id:8,code:"PA-2024-008",content:"Phòng chờ quá đông, không đủ ghế ngồi cho bệnh nhân",doctorId:103,doctorName:"BS. Lê Văn C",departmentId:3,departmentName:"Da liễu",completedDate:"27/11/2024",rating:null,comment:null,processHistory:[{date:"25/11/2024 14:00",handler:"Lê Thị Tiếp Nhận",action:"Tiếp nhận",note:"Tiếp nhận phản ánh trực tiếp"},{date:"26/11/2024 09:00",handler:"BS. Lê Văn C",action:"Đang xử lý",note:"Đã khảo sát thực tế, đề xuất bổ sung ghế"},{date:"27/11/2024 10:00",handler:"BS. Lê Văn C",action:"Hoàn thành",note:"Đã bổ sung 10 ghế ngồi, sắp xếp lại không gian chờ"}]}],S=async()=>{R.value=!0;try{{await new Promise(i=>setTimeout(i,500));let s=[...m];x.value==="pending"?s=s.filter(i=>!i.rating):x.value==="rated"&&(s=s.filter(i=>i.rating)),B.value&&(s=s.filter(i=>i.departmentId===B.value)),k.value=s,L.value=s.length,g.total=m.length,g.pending=m.filter(i=>!i.rating).length,g.rated=m.filter(i=>i.rating).length;const t=m.filter(i=>i.rating);g.avgRating=t.length>0?(t.reduce((i,f)=>i+f.rating,0)/t.length).toFixed(1):0}}catch(s){H.error("Lỗi khi tải dữ liệu"),console.error(s)}finally{R.value=!1}},J=async()=>{z.value=[{id:1,name:"Nội khoa"},{id:2,name:"Ngoại khoa"},{id:3,name:"Da liễu"},{id:4,name:"Sản khoa"},{id:5,name:"Nhi khoa"}]},Y=()=>{x.value=null,B.value=null,P.value=[],S()},Z=s=>{C.value=s,S()},tt=s=>{E.value=s,S()},nt=s=>({"Tiếp nhận":"primary","Đang xử lý":"warning","Xử lý xong":"success","Hoàn thành":"success"})[s]||"info",et=s=>({"Tiếp nhận":"info","Đang xử lý":"warning","Xử lý xong":"success","Hoàn thành":"success"})[s]||"",F=s=>{c.value={...s},u.rating=s.rating||0,u.comment=s.comment||"",V.value=!0},at=async()=>{var s,t;if(A.value)try{await A.value.validate(),w.value=!0;{await new Promise(r=>setTimeout(r,800));const i=k.value.findIndex(r=>r.id===c.value.id);i!==-1&&(k.value[i].rating=u.rating,k.value[i].comment=u.comment);const f=m.findIndex(r=>r.id===c.value.id);f!==-1&&(m[f].rating=u.rating,m[f].comment=u.comment),H.success(c.value.rating?"Cập nhật đánh giá thành công!":"Đánh giá thành công!"),V.value=!1,g.pending=m.filter(r=>!r.rating).length,g.rated=m.filter(r=>r.rating).length;const y=m.filter(r=>r.rating);g.avgRating=y.length>0?(y.reduce((r,N)=>r+N.rating,0)/y.length).toFixed(1):0}}catch(i){i!==!1&&H.error(((t=(s=i.response)==null?void 0:s.data)==null?void 0:t.message)||i.message||"Có lỗi xảy ra. Vui lòng thử lại.")}finally{w.value=!1}};return vt(()=>{J(),S()}),(s,t)=>{var O;const i=St,f=Vt,y=Bt,r=It,N=Dt,ot=ft,I=yt,b=At,it=Ht,q=Lt,M=zt,X=Ft,st=xt,lt=Tt,dt=Ot,ct=Ut,U=Gt,rt=Kt,ht=jt,gt=kt,ut=Nt;return p(),T("div",$t,[t[24]||(t[24]=n("div",{class:"page-header"},[n("h3",{class:"page-title"},"Đánh giá Bác sĩ sau xử lý"),n("p",{class:"page-desc"},"Đánh giá chất lượng xử lý của bác sĩ sau khi phản ánh được hoàn thành")],-1)),n("div",Qt,[e(ot,{gutter:16},{default:o(()=>[e(y,{xs:24,sm:8,md:6},{default:o(()=>[e(f,{modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=a=>x.value=a),placeholder:"Trạng thái đánh giá",clearable:"",style:{width:"100%"}},{default:o(()=>[e(i,{label:"Chưa đánh giá",value:"pending"}),e(i,{label:"Đã đánh giá",value:"rated"})]),_:1},8,["modelValue"])]),_:1}),e(y,{xs:24,sm:8,md:6},{default:o(()=>[e(f,{modelValue:B.value,"onUpdate:modelValue":t[1]||(t[1]=a=>B.value=a),placeholder:"Phòng ban",clearable:"",style:{width:"100%"}},{default:o(()=>[(p(!0),T(G,null,K(z.value,a=>(p(),D(i,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(y,{xs:24,sm:8,md:6},{default:o(()=>[e(r,{modelValue:P.value,"onUpdate:modelValue":t[2]||(t[2]=a=>P.value=a),type:"daterange","range-separator":"-","start-placeholder":"Từ ngày","end-placeholder":"Đến ngày",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(y,{xs:24,sm:24,md:6},{default:o(()=>[e(N,{type:"primary",onClick:S,icon:v(Rt)},{default:o(()=>[...t[9]||(t[9]=[_("Tìm kiếm",-1)])]),_:1},8,["icon"]),e(N,{onClick:Y,icon:v(wt)},{default:o(()=>[...t[10]||(t[10]=[_("Đặt lại",-1)])]),_:1},8,["icon"])]),_:1})]),_:1})]),n("div",Wt,[n("div",Jt,[n("div",Yt,[e(I,null,{default:o(()=>[e(v($))]),_:1})]),n("div",Zt,[n("span",tn,d(g.total),1),t[11]||(t[11]=n("span",{class:"stat-label"},"Tổng PA hoàn thành",-1))])]),n("div",nn,[n("div",en,[e(I,null,{default:o(()=>[e(v(Ct))]),_:1})]),n("div",an,[n("span",on,d(g.pending),1),t[12]||(t[12]=n("span",{class:"stat-label"},"Chờ đánh giá",-1))])]),n("div",sn,[n("div",ln,[e(I,null,{default:o(()=>[e(v(Et))]),_:1})]),n("div",dn,[n("span",cn,d(g.rated),1),t[13]||(t[13]=n("span",{class:"stat-label"},"Đã đánh giá",-1))])]),n("div",rn,[n("div",hn,[e(I,null,{default:o(()=>[e(v(Pt))]),_:1})]),n("div",gn,[n("span",un,d(g.avgRating),1),t[14]||(t[14]=n("span",{class:"stat-label"},"Điểm TB",-1))])])]),n("div",mn,[t[15]||(t[15]=n("div",{class:"content-card-header"},[n("h4",{class:"content-card-title"},"Danh sách phản ánh đã hoàn thành")],-1)),bt((p(),D(st,{data:k.value,stripe:"",onRowClick:F,class:"rating-table",style:{width:"100%"}},{default:o(()=>[e(b,{prop:"code",label:"Mã PA",width:"130"}),e(b,{prop:"content",label:"Nội dung","min-width":"280"},{default:o(({row:a})=>[e(it,{content:a.content,placement:"top","show-after":500},{default:o(()=>[n("span",pn,d(a.content),1)]),_:2},1032,["content"])]),_:1}),e(b,{prop:"doctorName",label:"Bác sĩ","min-width":"150"},{default:o(({row:a})=>[n("div",_n,[e(q,{size:28,class:"doctor-avatar"},{default:o(()=>{var l;return[_(d((l=a.doctorName)==null?void 0:l.charAt(0)),1)]}),_:2},1024),n("span",vn,d(a.doctorName||"-"),1)])]),_:1}),e(b,{prop:"departmentName",label:"Phòng","min-width":"100"}),e(b,{prop:"completedDate",label:"Ngày HT",width:"105"}),e(b,{prop:"ratingStatus",label:"Trạng thái",width:"110"},{default:o(({row:a})=>[e(M,{type:a.rating?"success":"warning",size:"small"},{default:o(()=>[_(d(a.rating?"Đã đánh giá":"Chờ đánh giá"),1)]),_:2},1032,["type"])]),_:1}),e(b,{prop:"rating",label:"Đánh giá",width:"140"},{default:o(({row:a})=>[a.rating?(p(),D(X,{key:0,modelValue:a.rating,"onUpdate:modelValue":l=>a.rating=l,disabled:"","show-score":"","text-color":"#ff9900",size:"small"},null,8,["modelValue","onUpdate:modelValue"])):(p(),T("span",fn,"Chưa có"))]),_:1}),e(b,{label:"Thao tác",width:"100",fixed:"right"},{default:o(({row:a})=>[e(N,{type:"primary",icon:a.rating?v(Mt):v($),size:"small",onClick:qt(l=>F(a),["stop"])},{default:o(()=>[_(d(a.rating?"Sửa":"Đánh giá"),1)]),_:2},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[ut,R.value]]),n("div",yn,[e(lt,{"current-page":C.value,"onUpdate:currentPage":t[3]||(t[3]=a=>C.value=a),"page-size":E.value,"onUpdate:pageSize":t[4]||(t[4]=a=>E.value=a),"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",total:L.value,onSizeChange:tt,onCurrentChange:Z},null,8,["current-page","page-size","total"])])]),e(gt,{modelValue:V.value,"onUpdate:modelValue":t[8]||(t[8]=a=>V.value=a),title:(O=c.value)!=null&&O.rating?"Chỉnh sửa đánh giá":"Đánh giá Bác sĩ",width:"700px",class:"rating-dialog","close-on-click-modal":!1,draggable:"",top:"5vh"},{footer:o(()=>[e(N,{onClick:t[7]||(t[7]=a=>V.value=!1)},{default:o(()=>[...t[23]||(t[23]=[_("Hủy",-1)])]),_:1}),e(N,{type:"primary",onClick:at,loading:w.value},{default:o(()=>{var a;return[_(d((a=c.value)!=null&&a.rating?"Cập nhật":"Lưu đánh giá"),1)]}),_:1},8,["loading"])]),default:o(()=>{var a;return[c.value?(p(),T("div",bn,[n("div",Nn,[t[19]||(t[19]=n("h4",{class:"section-title"},"Thông tin phản ánh",-1)),n("div",Tn,[n("div",kn,[t[16]||(t[16]=n("span",{class:"info-label"},"Mã PA:",-1)),n("span",xn,d(c.value.code),1)]),n("div",Bn,[t[17]||(t[17]=n("span",{class:"info-label"},"Phòng ban:",-1)),n("span",Vn,d(c.value.departmentName),1)]),n("div",Sn,[t[18]||(t[18]=n("span",{class:"info-label"},"Nội dung:",-1)),n("span",In,d(c.value.content),1)])])]),n("div",Dn,[t[20]||(t[20]=n("h4",{class:"section-title"},"Bác sĩ được đánh giá",-1)),n("div",Rn,[e(q,{size:56,class:"doctor-profile-avatar"},{default:o(()=>{var l;return[_(d((l=c.value.doctorName)==null?void 0:l.charAt(0)),1)]}),_:1}),n("div",wn,[n("span",Cn,d(c.value.doctorName),1),n("span",En,d(c.value.departmentName),1)])])]),(a=c.value.processHistory)!=null&&a.length?(p(),T("div",Pn,[n("h4",An,[e(I,null,{default:o(()=>[e(v(Xt))]),_:1}),t[21]||(t[21]=_(" Lịch sử xử lý ",-1))]),e(ct,null,{default:o(()=>[(p(!0),T(G,null,K(c.value.processHistory,(l,mt)=>(p(),D(dt,{key:mt,type:nt(l.action),timestamp:l.date,placement:"top"},{default:o(()=>[n("div",Hn,[n("div",Ln,[e(M,{type:et(l.action),size:"small"},{default:o(()=>[_(d(l.action),1)]),_:2},1032,["type"]),n("span",zn,d(l.handler),1)]),n("div",Fn,d(l.note),1)])]),_:2},1032,["type","timestamp"]))),128))]),_:1})])):Q("",!0),n("div",qn,[t[22]||(t[22]=n("h4",{class:"section-title"},"Đánh giá chất lượng xử lý",-1)),e(ht,{model:u,ref_key:"ratingFormRef",ref:A,rules:W,"label-position":"top"},{default:o(()=>[e(U,{label:"Đánh giá (1-5 sao)",prop:"rating"},{default:o(()=>[n("div",Mn,[e(X,{modelValue:u.rating,"onUpdate:modelValue":t[5]||(t[5]=l=>u.rating=l),"show-score":"","show-text":"",texts:["Rất tệ","Tệ","Bình thường","Tốt","Rất tốt"],"text-color":"#ff9900",size:"large"},null,8,["modelValue"])])]),_:1}),e(U,{label:"Nhận xét",prop:"comment"},{default:o(()=>[e(rt,{modelValue:u.comment,"onUpdate:modelValue":t[6]||(t[6]=l=>u.comment=l),type:"textarea",rows:3,placeholder:"Nhập nhận xét về chất lượng xử lý của bác sĩ...",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])])):Q("",!0)]}),_:1},8,["modelValue","title"])])}}},ee=pt(Xn,[["__scopeId","data-v-c8ab2b20"]]);export{ee as default};
