import{_ as le,r as _,a as ne,z as y,B as oe,c as D,b as e,d as t,p as c,w as s,s as de,a1 as ie,j as m,aN as ce,q as re,x as o,W as z,Z as ue,A as N,f as pe,D as me,g as _e,o as r,aO as F,ac as ge,H as he,G as ve,aP as fe,N as be,Q as ye,aQ as De,M as Ne,at as Ee,X as ke,ay as xe,az as Te,aA as Ce,P as Pe,aR as we,y as Y}from"./index-BgKCwKch.js";/* empty css                   *//* empty css                    *//* empty css                        *//* empty css                    *//* empty css                    *//* empty css               *//* empty css                             */import{r as w}from"./reportService-XJ75aB6C.js";import{_ as Re}from"./BarChart-Bk3bdCf9.js";const Be={class:"report-by-department"},Se={class:"content-card"},Me={class:"content-card-header"},Ve={class:"content-card-title"},Ae={class:"header-actions"},Ie={class:"stats-grid"},Oe={class:"stat-card stat-total"},Ge={class:"stat-icon"},Le={class:"stat-info"},ze={class:"stat-value"},Fe={class:"stat-card stat-completed"},Ye={class:"stat-icon"},He={class:"stat-info"},Xe={class:"stat-value"},qe={class:"stat-card stat-processing"},Qe={class:"stat-icon"},Ue={class:"stat-info"},$e={class:"stat-value"},je={class:"stat-card stat-time"},Ke={class:"stat-icon"},We={class:"stat-info"},Ze={class:"stat-value"},Je={class:"table-wrapper"},et={class:"dept-name"},tt={key:1},at={key:1},st={key:1,class:"text-muted"},lt={class:"progress-text"},nt={class:"content-card"},ot={class:"content-card-header"},dt={class:"content-card-title"},it={class:"chart-container"},ct={key:0,class:"detail-content"},rt={class:"detail-summary"},ut={class:"summary-item"},pt={class:"summary-value"},mt={class:"summary-item"},_t={class:"summary-value text-success"},gt={class:"summary-item"},ht={class:"summary-value text-warning"},vt={class:"summary-item"},ft={class:"summary-value text-danger"},bt={class:"summary-item"},yt={class:"summary-value"},Dt={class:"content-preview"},Nt={__name:"ReportByDepartment",setup(Et){const H=_e(),T=_(!1),C=_(!1),f=_([]),h=_([]),b=_(!1),u=_(null),g=_([]),E=_("all"),p=ne({total:0,completed:0,processing:0,avgTime:0}),X=y(()=>({labels:f.value.map(n=>n.departmentName),datasets:[{label:"Số phản ánh",data:f.value.map(n=>n.total),backgroundColor:"rgba(13, 110, 253, 0.8)"}]})),R=y(()=>g.value.filter(n=>n.status==="PENDING")),B=y(()=>g.value.filter(n=>n.status==="PROCESSING")),S=y(()=>g.value.filter(n=>n.status==="COMPLETED")),q=y(()=>{switch(E.value){case"pending":return R.value;case"processing":return B.value;case"completed":return S.value;default:return g.value}}),M=async()=>{var n,a;T.value=!0;try{const d=await w.getByDepartment({startMonth:(n=h.value)==null?void 0:n[0],endMonth:(a=h.value)==null?void 0:a[1]});f.value=d.data||[],Object.assign(p,d.summary||{})}catch{f.value=[{id:1,departmentName:"Nội khoa",total:45,pending:5,processing:8,completed:32,overdue:2,avgDays:2.3,completionRate:71},{id:2,departmentName:"Ngoại khoa",total:38,pending:3,processing:5,completed:30,overdue:1,avgDays:1.8,completionRate:79},{id:3,departmentName:"Da liễu",total:25,pending:2,processing:3,completed:20,overdue:0,avgDays:1.5,completionRate:80},{id:4,departmentName:"Sản khoa",total:30,pending:4,processing:6,completed:20,overdue:3,avgDays:2.8,completionRate:67},{id:5,departmentName:"Nhi khoa",total:22,pending:1,processing:2,completed:19,overdue:0,avgDays:1.2,completionRate:86}],p.total=160,p.completed=121,p.processing=24,p.avgTime=2.1}finally{T.value=!1}},Q=async n=>{u.value=n,E.value="all",b.value=!0,await U(n.id)},U=async n=>{C.value=!0;try{const a=await w.getDepartmentFeedbacks(n);g.value=a.data||[]}catch{g.value=[{id:1,code:"PA-2024-001",content:"Thời gian chờ khám quá lâu, bệnh nhân phải đợi hơn 2 tiếng",status:"COMPLETED",createdDate:"15/11/2024",handlerName:"BS. Nguyễn Văn A"},{id:2,code:"PA-2024-002",content:"Nhân viên lễ tân thiếu thân thiện với bệnh nhân cao tuổi",status:"PROCESSING",createdDate:"16/11/2024",handlerName:"Trần Thị B"},{id:3,code:"PA-2024-003",content:"Phòng khám thiếu sạch sẽ, cần cải thiện vệ sinh",status:"PENDING",createdDate:"17/11/2024",handlerName:null},{id:4,code:"PA-2024-004",content:"Khen ngợi bác sĩ điều trị nhiệt tình, chuyên nghiệp",status:"COMPLETED",createdDate:"18/11/2024",handlerName:"BS. Lê Văn C"},{id:5,code:"PA-2024-005",content:"Cơ sở vật chất xuống cấp, máy lạnh không hoạt động",status:"PROCESSING",createdDate:"19/11/2024",handlerName:"Phạm Văn D"}]}finally{C.value=!1}},$=n=>n>=80?"#67C23A":n>=60?"#E6A23C":"#F56C6C",j=n=>({PENDING:"danger",PROCESSING:"warning",COMPLETED:"success"})[n]||"info",K=n=>({PENDING:"Chưa xử lý",PROCESSING:"Đang xử lý",COMPLETED:"Hoàn thành"})[n]||n,W=()=>{var n;b.value=!1,H.push({path:"/feedback",query:{departmentId:(n=u.value)==null?void 0:n.id}})},Z=async()=>{var n,a;try{const d=await w.exportExcel({type:"by-department",startMonth:(n=h.value)==null?void 0:n[0],endMonth:(a=h.value)==null?void 0:a[1]});we(d,`bao-cao-theo-phong-${Date.now()}.xlsx`),Y.success("Xuất Excel thành công!")}catch{Y.error("Xuất Excel thất bại!")}};return oe(()=>{M()}),(n,a)=>{var I;const d=de,J=ie,P=re,i=be,v=ye,ee=De,V=me,k=Ce,x=Te,te=xe,ae=Pe,se=pe,A=ue;return r(),D("div",Be,[e("div",Se,[e("div",Me,[e("h3",Ve,[t(d,null,{default:s(()=>[t(m(F))]),_:1}),a[4]||(a[4]=c(" Báo cáo theo Phòng ban ",-1))]),e("div",Ae,[t(J,{modelValue:h.value,"onUpdate:modelValue":a[0]||(a[0]=l=>h.value=l),type:"monthrange","start-placeholder":"Từ tháng","end-placeholder":"Đến tháng",format:"MM/YYYY","value-format":"YYYY-MM",onChange:M},null,8,["modelValue"]),t(P,{type:"success",icon:m(ce),onClick:Z},{default:s(()=>[...a[5]||(a[5]=[c(" Xuất Excel ",-1)])]),_:1},8,["icon"])])]),e("div",Ie,[e("div",Oe,[e("div",Ge,[t(d,null,{default:s(()=>[t(m(ge))]),_:1})]),e("div",Le,[e("span",ze,o(p.total),1),a[6]||(a[6]=e("span",{class:"stat-label"},"Tổng phản ánh",-1))])]),e("div",Fe,[e("div",Ye,[t(d,null,{default:s(()=>[t(m(he))]),_:1})]),e("div",He,[e("span",Xe,o(p.completed),1),a[7]||(a[7]=e("span",{class:"stat-label"},"Đã hoàn thành",-1))])]),e("div",qe,[e("div",Qe,[t(d,null,{default:s(()=>[t(m(ve))]),_:1})]),e("div",Ue,[e("span",$e,o(p.processing),1),a[8]||(a[8]=e("span",{class:"stat-label"},"Đang xử lý",-1))])]),e("div",je,[e("div",Ke,[t(d,null,{default:s(()=>[t(m(fe))]),_:1})]),e("div",We,[e("span",Ze,[c(o(p.avgTime),1),a[9]||(a[9]=e("small",null," ngày",-1))]),a[10]||(a[10]=e("span",{class:"stat-label"},"Thời gian TB",-1))])])]),e("div",Je,[z((r(),N(V,{data:f.value,stripe:"","show-summary":"","row-class-name":"clickable-row",onRowClick:Q},{default:s(()=>[t(i,{prop:"departmentName",label:"Phòng ban","min-width":"180"},{default:s(({row:l})=>[e("div",et,[t(d,{class:"dept-icon"},{default:s(()=>[t(m(F))]),_:1}),c(" "+o(l.departmentName),1)])]),_:1}),t(i,{prop:"total",label:"Tổng PA",width:"100",align:"center",sortable:""}),t(i,{prop:"pending",label:"Chưa xử lý",width:"110",align:"center"},{default:s(({row:l})=>[l.pending>0?(r(),N(v,{key:0,type:"danger",size:"small"},{default:s(()=>[c(o(l.pending),1)]),_:2},1024)):(r(),D("span",tt,"0"))]),_:1}),t(i,{prop:"processing",label:"Đang xử lý",width:"110",align:"center"},{default:s(({row:l})=>[l.processing>0?(r(),N(v,{key:0,type:"warning",size:"small"},{default:s(()=>[c(o(l.processing),1)]),_:2},1024)):(r(),D("span",at,"0"))]),_:1}),t(i,{prop:"completed",label:"Hoàn thành",width:"110",align:"center"},{default:s(({row:l})=>[t(v,{type:"success",size:"small"},{default:s(()=>[c(o(l.completed),1)]),_:2},1024)]),_:1}),t(i,{prop:"overdue",label:"Quá hạn",width:"100",align:"center"},{default:s(({row:l})=>[l.overdue>0?(r(),N(v,{key:0,type:"danger",effect:"dark",size:"small"},{default:s(()=>[c(o(l.overdue),1)]),_:2},1024)):(r(),D("span",st,"0"))]),_:1}),t(i,{prop:"avgDays",label:"Thời gian TB",width:"120",align:"center"},{default:s(({row:l})=>[t(v,{type:l.avgDays<=2?"success":l.avgDays<=3?"warning":"danger",size:"small"},{default:s(()=>[c(o(l.avgDays)+" ngày ",1)]),_:2},1032,["type"])]),_:1}),t(i,{prop:"completionRate",label:"Tỷ lệ HT",width:"140",align:"center",sortable:""},{default:s(({row:l})=>[t(ee,{percentage:l.completionRate,"stroke-width":10,color:$(l.completionRate)},{default:s(()=>[e("span",lt,o(l.completionRate)+"%",1)]),_:2},1032,["percentage","color"])]),_:1}),t(i,{label:"",width:"60",align:"center"},{default:s(()=>[t(d,{class:"view-icon"},{default:s(()=>[t(m(Ne))]),_:1})]),_:1})]),_:1},8,["data"])),[[A,T.value]])])]),e("div",nt,[e("div",ot,[e("h3",dt,[t(d,null,{default:s(()=>[t(m(Ee))]),_:1}),a[11]||(a[11]=c(" Biểu đồ so sánh ",-1))])]),e("div",it,[t(Re,{data:X.value},null,8,["data"])])]),t(se,{modelValue:b.value,"onUpdate:modelValue":a[3]||(a[3]=l=>b.value=l),title:"Chi tiết: "+((I=u.value)==null?void 0:I.departmentName),width:"900px",class:"detail-dialog"},{footer:s(()=>[t(P,{onClick:a[2]||(a[2]=l=>b.value=!1)},{default:s(()=>[...a[17]||(a[17]=[c("Đóng",-1)])]),_:1}),t(P,{type:"primary",onClick:W},{default:s(()=>[...a[18]||(a[18]=[c("Xem tất cả phản ánh",-1)])]),_:1})]),default:s(()=>[u.value?(r(),D("div",ct,[e("div",rt,[e("div",ut,[a[12]||(a[12]=e("span",{class:"summary-label"},"Tổng phản ánh",-1)),e("span",pt,o(u.value.total),1)]),e("div",mt,[a[13]||(a[13]=e("span",{class:"summary-label"},"Hoàn thành",-1)),e("span",_t,o(u.value.completed),1)]),e("div",gt,[a[14]||(a[14]=e("span",{class:"summary-label"},"Đang xử lý",-1)),e("span",ht,o(u.value.processing),1)]),e("div",vt,[a[15]||(a[15]=e("span",{class:"summary-label"},"Chưa xử lý",-1)),e("span",ft,o(u.value.pending),1)]),e("div",bt,[a[16]||(a[16]=e("span",{class:"summary-label"},"Tỷ lệ HT",-1)),e("span",yt,o(u.value.completionRate)+"%",1)])]),t(te,{modelValue:E.value,"onUpdate:modelValue":a[1]||(a[1]=l=>E.value=l),class:"detail-tabs"},{default:s(()=>[t(x,{label:"Tất cả",name:"all"},{default:s(()=>[t(k,{value:g.value.length,max:99,class:"tab-badge"},null,8,["value"])]),_:1}),t(x,{label:"Chưa xử lý",name:"pending"},{default:s(()=>[t(k,{value:R.value.length,max:99,type:"danger",class:"tab-badge"},null,8,["value"])]),_:1}),t(x,{label:"Đang xử lý",name:"processing"},{default:s(()=>[t(k,{value:B.value.length,max:99,type:"warning",class:"tab-badge"},null,8,["value"])]),_:1}),t(x,{label:"Hoàn thành",name:"completed"},{default:s(()=>[t(k,{value:S.value.length,max:99,type:"success",class:"tab-badge"},null,8,["value"])]),_:1})]),_:1},8,["modelValue"]),z((r(),N(V,{data:q.value,"max-height":"400"},{default:s(()=>[t(i,{prop:"code",label:"Mã PA",width:"120"}),t(i,{prop:"content",label:"Nội dung","min-width":"200"},{default:s(({row:l})=>{var O;return[t(ae,{content:l.content,placement:"top",disabled:((O=l.content)==null?void 0:O.length)<50},{default:s(()=>{var G,L;return[e("span",Dt,o((G=l.content)==null?void 0:G.substring(0,50))+o(((L=l.content)==null?void 0:L.length)>50?"...":""),1)]}),_:2},1032,["content","disabled"])]}),_:1}),t(i,{prop:"status",label:"Trạng thái",width:"120",align:"center"},{default:s(({row:l})=>[t(v,{type:j(l.status),size:"small"},{default:s(()=>[c(o(K(l.status)),1)]),_:2},1032,["type"])]),_:1}),t(i,{prop:"createdDate",label:"Ngày tạo",width:"120",align:"center"}),t(i,{prop:"handlerName",label:"Người xử lý",width:"150"})]),_:1},8,["data"])),[[A,C.value]])])):ke("",!0)]),_:1},8,["modelValue","title"])])}}},Vt=le(Nt,[["__scopeId","data-v-567f1232"]]);export{Vt as default};
