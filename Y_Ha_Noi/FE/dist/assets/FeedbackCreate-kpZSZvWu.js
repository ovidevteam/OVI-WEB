import{_ as A,r as m,z as D,a7 as U,a8 as F,c as _,o as u,d as e,w as a,s as G,j as V,Y as K,b as r,x as $,a9 as j,f as J,y as w,aa as X,a as Y,B as Q,ab as Z,E as ee,g as le,p as b,ac as te,ad as ae,ae as ne,h as oe,C as se,J as C,K as B,af as ie,A as S,L as ue,ag as re,a3 as de,ah as ce,i as me,ai as pe,q as he}from"./index-CEoFeFsB.js";/* empty css               *//* empty css                       *//* empty css               *//* empty css                  */import{f as fe}from"./feedbackService-DQNK-YXO.js";import{d as _e}from"./departmentService-GW46A7lu.js";import{d as ve}from"./doctorService-CMLEbOr4.js";/* empty css                  *//* empty css                    */const ge={class:"image-upload"},be={class:"upload-tip"},Ve=["src"],we={__name:"ImageUpload",props:{modelValue:{type:Array,default:()=>[]},max:{type:Number,default:10},tip:{type:String,default:"Tối đa 10 ảnh, mỗi ảnh không quá 5MB"}},emits:["update:modelValue"],setup(y,{emit:k}){const h=y,v=k,d=m([]),c=m(!1),g=m(""),x=D(()=>"http://localhost:8080/api/upload/images"),n=D(()=>U.acceptExtensions.join(","));F(()=>h.modelValue,o=>{o.length!==d.value.length&&(d.value=o.map(s=>({name:s.name||"image",url:s.url||s})))},{immediate:!0}),F(d,o=>{v("update:modelValue",o)},{deep:!0});const L=o=>{const s=U.acceptTypes.includes(o.type),i=o.size<=U.maxSize;return s?i?!0:(w.error(`Kích thước file không được vượt quá ${X(U.maxSize)}!`),!1):(w.error("Chỉ chấp nhận file ảnh JPG, PNG, WEBP!"),!1)},E=o=>{g.value=o.url,c.value=!0},q=(o,s)=>{},z=()=>{w.warning(`Chỉ được upload tối đa ${h.max} ảnh!`)};return(o,s)=>{const i=G,t=j,N=J;return u(),_("div",ge,[e(t,{"file-list":d.value,"onUpdate:fileList":s[0]||(s[0]=p=>d.value=p),action:x.value,"list-type":"picture-card",multiple:!0,limit:y.max,accept:n.value,"before-upload":L,"on-preview":E,"on-remove":q,"on-exceed":z,"auto-upload":!1},{tip:a(()=>[r("div",be,$(y.tip),1)]),default:a(()=>[e(i,null,{default:a(()=>[e(V(K))]),_:1})]),_:1},8,["file-list","action","limit","accept"]),e(N,{modelValue:c.value,"onUpdate:modelValue":s[1]||(s[1]=p=>c.value=p),title:"Xem ảnh",width:"800px"},{default:a(()=>[r("img",{src:g.value,alt:"Preview",class:"preview-image"},null,8,Ve)]),_:1},8,["modelValue"])])}}},ye=A(we,[["__scopeId","data-v-46469235"]]),ke={class:"feedback-create"},xe={class:"content-card"},Ee={class:"form-section"},Ne={class:"form-section-title"},Ie={class:"form-section"},Ue={class:"form-section-title"},Ce={class:"form-actions"},Be={__name:"FeedbackCreate",setup(y){const k=le(),h=m(null),v=m(!1),d=m([]),c=m([]),g=m(window.innerWidth),x=D(()=>g.value<768),n=Y({channel:"HOTLINE",level:"MEDIUM",departmentId:null,doctorId:null,content:"",note:"",images:[]}),L={channel:[{required:!0,message:"Vui lòng chọn kênh tiếp nhận",trigger:"change"}],level:[{required:!0,message:"Vui lòng chọn mức độ",trigger:"change"}],departmentId:[{required:!0,message:"Vui lòng chọn phòng ban",trigger:"change"}],content:[{required:!0,message:"Vui lòng nhập nội dung phản ánh",trigger:"blur"},{max:1e3,message:"Nội dung không được vượt quá 1000 ký tự",trigger:"blur"}]},E=()=>{g.value=window.innerWidth},q=async()=>{try{d.value=await _e.getActiveList()}catch{d.value=[{id:1,name:"Nội khoa"},{id:2,name:"Ngoại khoa"},{id:3,name:"Da liễu"},{id:4,name:"Sản khoa"}]}},z=async i=>{if(n.doctorId=null,i)try{c.value=await ve.getByDepartment(i)}catch{c.value=[{id:1,fullName:"BS. Nguyễn Văn A"},{id:2,fullName:"BS. Trần Thị B"}]}else c.value=[]},o=async()=>{if(h.value)try{await h.value.validate(),v.value=!0,await fe.create(n),w.success("Tạo phản ánh thành công!"),k.push("/feedback")}catch(i){i!==!1&&w.error("Có lỗi xảy ra. Vui lòng thử lại.")}finally{v.value=!1}},s=()=>{k.back()};return Q(()=>{q(),window.addEventListener("resize",E)}),Z(()=>{window.removeEventListener("resize",E)}),(i,t)=>{const N=G,p=ue,T=se,f=oe,I=ne,H=ce,O=re,M=ae,P=me,R=he,W=ee;return u(),_("div",ke,[r("div",xe,[t[11]||(t[11]=r("div",{class:"content-card-header"},[r("h3",{class:"content-card-title"},"Nhập Phản ánh mới")],-1)),e(W,{ref_key:"formRef",ref:h,model:n,rules:L,"label-width":x.value?"auto":"140px","label-position":x.value?"top":"left",class:"feedback-form"},{default:a(()=>[r("div",Ee,[r("h4",Ne,[e(N,null,{default:a(()=>[e(V(te))]),_:1}),t[7]||(t[7]=b(" Thông tin phản ánh ",-1))]),e(M,{gutter:20},{default:a(()=>[e(I,{xs:24,sm:12},{default:a(()=>[e(f,{label:"Kênh tiếp nhận",prop:"channel"},{default:a(()=>[e(T,{modelValue:n.channel,"onUpdate:modelValue":t[0]||(t[0]=l=>n.channel=l),placeholder:"Chọn kênh",style:{width:"100%"}},{default:a(()=>[(u(!0),_(C,null,B(V(ie),l=>(u(),S(p,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(I,{xs:24,sm:12},{default:a(()=>[e(f,{label:"Mức độ",prop:"level"},{default:a(()=>[e(O,{modelValue:n.level,"onUpdate:modelValue":t[1]||(t[1]=l=>n.level=l),class:"level-group"},{default:a(()=>[(u(!0),_(C,null,B(V(de),l=>(u(),S(H,{key:l.value,value:l.value},{default:a(()=>[b($(l.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(M,{gutter:20},{default:a(()=>[e(I,{xs:24,sm:12},{default:a(()=>[e(f,{label:"Phòng liên quan",prop:"departmentId"},{default:a(()=>[e(T,{modelValue:n.departmentId,"onUpdate:modelValue":t[2]||(t[2]=l=>n.departmentId=l),placeholder:"Chọn phòng ban",style:{width:"100%"},onChange:z},{default:a(()=>[(u(!0),_(C,null,B(d.value,l=>(u(),S(p,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(I,{xs:24,sm:12},{default:a(()=>[e(f,{label:"Bác sĩ liên quan"},{default:a(()=>[e(T,{modelValue:n.doctorId,"onUpdate:modelValue":t[3]||(t[3]=l=>n.doctorId=l),placeholder:"Chọn bác sĩ (nếu có)",style:{width:"100%"},clearable:""},{default:a(()=>[(u(!0),_(C,null,B(c.value,l=>(u(),S(p,{key:l.id,label:l.fullName,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(f,{label:"Nội dung",prop:"content"},{default:a(()=>[e(P,{modelValue:n.content,"onUpdate:modelValue":t[4]||(t[4]=l=>n.content=l),type:"textarea",rows:5,placeholder:"Nhập nội dung phản ánh chi tiết...",maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(f,{label:"Ghi chú"},{default:a(()=>[e(P,{modelValue:n.note,"onUpdate:modelValue":t[5]||(t[5]=l=>n.note=l),type:"textarea",rows:2,placeholder:"Ghi chú thêm (nếu có)..."},null,8,["modelValue"])]),_:1})]),r("div",Ie,[r("h4",Ue,[e(N,null,{default:a(()=>[e(V(pe))]),_:1}),t[8]||(t[8]=b(" Hình ảnh đính kèm ",-1))]),e(ye,{modelValue:n.images,"onUpdate:modelValue":t[6]||(t[6]=l=>n.images=l),max:10,tip:"Tối đa 10 ảnh, mỗi ảnh không quá 5MB"},null,8,["modelValue"])]),r("div",Ce,[e(R,{onClick:s,size:"large"},{default:a(()=>[...t[9]||(t[9]=[b("Hủy",-1)])]),_:1}),e(R,{type:"primary",loading:v.value,onClick:o,size:"large"},{default:a(()=>[...t[10]||(t[10]=[b(" Lưu phản ánh ",-1)])]),_:1},8,["loading"])])]),_:1},8,["model","label-width","label-position"])])])}}},Ae=A(Be,[["__scopeId","data-v-109deaaf"]]);export{Ae as default};
