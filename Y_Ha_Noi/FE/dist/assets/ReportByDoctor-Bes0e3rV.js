import{_ as at,r,A as ot,C as st,c as P,b as o,d as a,a1 as O,p,w as s,s as lt,F as nt,a7 as it,j as v,aU as ct,q as dt,a4 as rt,B as V,a6 as pt,f as ut,G as ht,g as mt,o as m,k as gt,P as _t,Q as vt,R as ft,T as yt,az as bt,x as n,W as Dt,aW as Nt,aA as Tt,S as Et,ay as kt,a2 as xt,V as wt,aY as Ct,y as U}from"./index-WXSJfKjD.js";/* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                        *//* empty css                    *//* empty css                *//* empty css                             */import{r as B}from"./reportService-DKYPtXve.js";import{d as Pt}from"./departmentService-CYi6ROd7.js";import{_ as Vt}from"./BarChart-BO9Soj_s.js";const Bt={class:"report-by-doctor"},St={class:"content-card"},Mt={class:"content-card-header"},At={class:"content-card-title"},Lt={class:"header-actions"},zt={class:"doctor-info"},Rt={class:"doctor-details"},It={class:"doctor-name"},Ot={class:"doctor-dept"},Ut={class:"text-success font-bold"},Yt={class:"rating-cell"},Gt={class:"pagination-wrapper"},Ft={class:"content-card"},Xt={class:"content-card-header"},Ht={class:"content-card-title"},qt={class:"chart-container"},$t={key:0,class:"detail-content"},Wt={class:"doctor-profile"},jt={class:"profile-info"},Kt={class:"profile-name"},Qt={class:"profile-specialty"},Jt={class:"profile-dept"},Zt={class:"profile-rating"},te={class:"detail-stats"},ee={class:"detail-stat-card"},ae={class:"stat-number"},oe={class:"detail-stat-card success"},se={class:"stat-number"},le={class:"detail-stat-card warning"},ne={class:"stat-number"},ie={class:"detail-stat-card info"},ce={class:"stat-number"},de={class:"detail-section"},re={class:"content-preview"},pe={__name:"ReportByDoctor",setup(ue){const Y=mt(),b=r(!1),D=r(!1),f=r([]),N=r([]),y=r(""),h=r([]),T=r(1),E=r(20),k=r(0),g=r(!1),i=r(null),x=r([]),G=ot(()=>{const l=[...f.value].sort((t,c)=>t.avgDays-c.avgDays).slice(0,10);return{labels:l.map(t=>t.doctorName),datasets:[{label:"Thời gian xử lý TB (ngày)",data:l.map(t=>t.avgDays),backgroundColor:l.map(t=>t.avgDays<=1.5?"rgba(103, 194, 58, 0.8)":t.avgDays<=2.5?"rgba(230, 162, 60, 0.8)":"rgba(245, 108, 108, 0.8)")}]}}),w=async()=>{var l,t;b.value=!0;try{const c=await B.getByDoctor({departmentId:y.value,startMonth:(l=h.value)==null?void 0:l[0],endMonth:(t=h.value)==null?void 0:t[1],page:T.value,size:E.value});f.value=c.data||[],k.value=c.total||0}catch{f.value=[{id:1,doctorName:"BS. Nguyễn Văn A",departmentName:"Nội khoa",specialty:"Nội khoa",total:25,completed:23,avgDays:1.2,rating:4.8},{id:2,doctorName:"BS. Trần Thị B",departmentName:"Ngoại khoa",specialty:"Ngoại khoa",total:20,completed:18,avgDays:1.5,rating:4.5},{id:3,doctorName:"BS. Lê Văn C",departmentName:"Da liễu",specialty:"Da liễu",total:18,completed:17,avgDays:1.8,rating:4.6},{id:4,doctorName:"BS. Phạm Thị D",departmentName:"Sản khoa",specialty:"Sản khoa",total:15,completed:12,avgDays:2.5,rating:4.2},{id:5,doctorName:"BS. Hoàng Văn E",departmentName:"Nhi khoa",specialty:"Nhi khoa",total:22,completed:21,avgDays:1,rating:4.9}],k.value=5}finally{b.value=!1}},F=async()=>{try{N.value=await Pt.getActiveList()}catch{N.value=[{id:1,name:"Nội khoa"},{id:2,name:"Ngoại khoa"},{id:3,name:"Da liễu"},{id:4,name:"Sản khoa"},{id:5,name:"Nhi khoa"}]}},X=async l=>{i.value=l,g.value=!0,await H(l.id)},H=async l=>{D.value=!0;try{const t=await B.getDoctorFeedbacks(l);x.value=t.data||[]}catch{x.value=[{id:1,code:"PA-2024-001",content:"Thời gian chờ khám quá lâu, bệnh nhân phải đợi hơn 2 tiếng",status:"COMPLETED",processingTime:1.5,completedDate:"20/11/2024"},{id:2,code:"PA-2024-004",content:"Khen ngợi bác sĩ điều trị nhiệt tình, chuyên nghiệp",status:"COMPLETED",processingTime:.5,completedDate:"22/11/2024"},{id:3,code:"PA-2024-007",content:"Bác sĩ giải thích rõ ràng về tình trạng bệnh và phác đồ điều trị",status:"COMPLETED",processingTime:1,completedDate:"24/11/2024"},{id:4,code:"PA-2024-010",content:"Phản hồi nhanh chóng khi bệnh nhân có thắc mắc về thuốc",status:"COMPLETED",processingTime:2,completedDate:"25/11/2024"},{id:5,code:"PA-2024-015",content:"Cần cải thiện thái độ phục vụ trong giờ cao điểm",status:"PROCESSING",processingTime:1.5,completedDate:null}]}finally{D.value=!1}},q=l=>({PENDING:"danger",PROCESSING:"warning",COMPLETED:"success"})[l]||"info",$=l=>({PENDING:"Chưa xử lý",PROCESSING:"Đang xử lý",COMPLETED:"Hoàn thành"})[l]||l,W=()=>{var l;g.value=!1,Y.push({path:"/feedback",query:{doctorId:(l=i.value)==null?void 0:l.id}})},j=async()=>{var l,t;try{const c=await B.exportExcel({type:"by-doctor",departmentId:y.value,startMonth:(l=h.value)==null?void 0:l[0],endMonth:(t=h.value)==null?void 0:t[1]});Ct(c,`bao-cao-theo-bac-si-${Date.now()}.xlsx`),U.success("Xuất Excel thành công!")}catch{U.error("Xuất Excel thất bại!")}};return st(()=>{w(),F()}),(l,t)=>{var z;const c=lt,K=ft,Q=nt,J=it,C=dt,d=yt,S=bt,_=Dt,M=Tt,A=ht,Z=pt,tt=wt,et=ut,L=rt;return m(),P("div",Bt,[o("div",St,[o("div",Mt,[o("h3",At,[a(c,null,{default:s(()=>[a(v(gt))]),_:1}),t[7]||(t[7]=p(" Báo cáo theo Bác sĩ ",-1))]),o("div",Lt,[a(Q,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=e=>y.value=e),placeholder:"Phòng ban",clearable:"",onChange:w,style:{width:"180px"}},{default:s(()=>[(m(!0),P(_t,null,vt(N.value,e=>(m(),V(K,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(J,{modelValue:h.value,"onUpdate:modelValue":t[1]||(t[1]=e=>h.value=e),type:"monthrange","start-placeholder":"Từ tháng","end-placeholder":"Đến tháng",format:"MM/YYYY","value-format":"YYYY-MM",onChange:w},null,8,["modelValue"]),a(C,{type:"success",icon:v(ct),onClick:j},{default:s(()=>[...t[8]||(t[8]=[p(" Xuất Excel ",-1)])]),_:1},8,["icon"])])]),O((m(),V(A,{data:f.value,stripe:"","row-class-name":"clickable-row",onRowClick:X},{default:s(()=>[a(d,{type:"index",label:"#",width:"50"}),a(d,{prop:"doctorName",label:"Bác sĩ","min-width":"200"},{default:s(({row:e})=>[o("div",zt,[a(S,{size:40,class:"doctor-avatar"},{default:s(()=>{var u;return[p(n((u=e.doctorName)==null?void 0:u.charAt(0)),1)]}),_:2},1024),o("div",Rt,[o("div",It,n(e.doctorName),1),o("div",Ot,n(e.departmentName),1)])])]),_:1}),a(d,{prop:"specialty",label:"Chuyên khoa",width:"140"},{default:s(({row:e})=>[a(_,{size:"small",effect:"plain"},{default:s(()=>[p(n(e.specialty),1)]),_:2},1024)]),_:1}),a(d,{prop:"total",label:"Tổng PA",width:"100",align:"center",sortable:""}),a(d,{prop:"completed",label:"Hoàn thành",width:"110",align:"center"},{default:s(({row:e})=>[o("span",Ut,n(e.completed),1)]),_:1}),a(d,{prop:"avgDays",label:"Thời gian TB",width:"130",align:"center",sortable:""},{default:s(({row:e})=>[a(_,{type:e.avgDays<=1.5?"success":e.avgDays<=2.5?"warning":"danger",size:"small",effect:"dark"},{default:s(()=>[a(c,null,{default:s(()=>[a(v(Nt))]),_:1}),p(" "+n(e.avgDays)+" ngày ",1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"rating",label:"Đánh giá",width:"180",align:"center"},{default:s(({row:e})=>[o("div",Yt,[a(M,{modelValue:e.rating,"onUpdate:modelValue":u=>e.rating=u,disabled:"","show-score":"","text-color":"#ff9900"},null,8,["modelValue","onUpdate:modelValue"])])]),_:1}),a(d,{label:"",width:"60",align:"center"},{default:s(()=>[a(c,{class:"view-icon"},{default:s(()=>[a(v(Et))]),_:1})]),_:1})]),_:1},8,["data"])),[[L,b.value]]),o("div",Gt,[a(Z,{"current-page":T.value,"onUpdate:currentPage":t[2]||(t[2]=e=>T.value=e),"page-size":E.value,"onUpdate:pageSize":t[3]||(t[3]=e=>E.value=e),total:k.value,layout:"total, prev, pager, next"},null,8,["current-page","page-size","total"])])]),o("div",Ft,[o("div",Xt,[o("h3",Ht,[a(c,null,{default:s(()=>[a(v(kt))]),_:1}),t[9]||(t[9]=p(" Top 10 Bác sĩ xử lý nhanh nhất ",-1))])]),o("div",qt,[a(Vt,{data:G.value},null,8,["data"])])]),a(et,{modelValue:g.value,"onUpdate:modelValue":t[6]||(t[6]=e=>g.value=e),title:"Chi tiết: "+((z=i.value)==null?void 0:z.doctorName),width:"900px",class:"detail-dialog"},{footer:s(()=>[a(C,{onClick:t[5]||(t[5]=e=>g.value=!1)},{default:s(()=>[...t[15]||(t[15]=[p("Đóng",-1)])]),_:1}),a(C,{type:"primary",onClick:W},{default:s(()=>[...t[16]||(t[16]=[p(" Xem tất cả phản ánh ",-1)])]),_:1})]),default:s(()=>[i.value?(m(),P("div",$t,[o("div",Wt,[a(S,{size:80,class:"profile-avatar"},{default:s(()=>{var e;return[p(n((e=i.value.doctorName)==null?void 0:e.charAt(0)),1)]}),_:1}),o("div",jt,[o("h3",Kt,n(i.value.doctorName),1),o("p",Qt,[a(_,null,{default:s(()=>[p(n(i.value.specialty),1)]),_:1}),o("span",Jt,n(i.value.departmentName),1)]),o("div",Zt,[a(M,{modelValue:i.value.rating,"onUpdate:modelValue":t[4]||(t[4]=e=>i.value.rating=e),disabled:"","show-score":"","text-color":"#ff9900"},null,8,["modelValue"])])])]),o("div",te,[o("div",ee,[o("span",ae,n(i.value.total),1),t[10]||(t[10]=o("span",{class:"stat-text"},"Tổng phản ánh",-1))]),o("div",oe,[o("span",se,n(i.value.completed),1),t[11]||(t[11]=o("span",{class:"stat-text"},"Đã hoàn thành",-1))]),o("div",le,[o("span",ne,n(i.value.avgDays),1),t[12]||(t[12]=o("span",{class:"stat-text"},"Thời gian TB (ngày)",-1))]),o("div",ie,[o("span",ce,n(Math.round(i.value.completed/i.value.total*100))+"%",1),t[13]||(t[13]=o("span",{class:"stat-text"},"Tỷ lệ hoàn thành",-1))])]),o("div",de,[t[14]||(t[14]=o("h4",{class:"section-title"},"Danh sách phản ánh đã xử lý",-1)),O((m(),V(A,{data:x.value,"max-height":"350"},{default:s(()=>[a(d,{prop:"code",label:"Mã PA",width:"120"}),a(d,{prop:"content",label:"Nội dung","min-width":"200"},{default:s(({row:e})=>{var u;return[a(tt,{content:e.content,placement:"top",disabled:((u=e.content)==null?void 0:u.length)<50},{default:s(()=>{var R,I;return[o("span",re,n((R=e.content)==null?void 0:R.substring(0,50))+n(((I=e.content)==null?void 0:I.length)>50?"...":""),1)]}),_:2},1032,["content","disabled"])]}),_:1}),a(d,{prop:"status",label:"Trạng thái",width:"120",align:"center"},{default:s(({row:e})=>[a(_,{type:q(e.status),size:"small"},{default:s(()=>[p(n($(e.status)),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"processingTime",label:"Thời gian XL",width:"120",align:"center"},{default:s(({row:e})=>[a(_,{type:e.processingTime<=2?"success":"warning",size:"small"},{default:s(()=>[p(n(e.processingTime)+" ngày ",1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"completedDate",label:"Ngày HT",width:"110",align:"center"})]),_:1},8,["data"])),[[L,D.value]])])])):xt("",!0)]),_:1},8,["modelValue","title"])])}}},ke=at(pe,[["__scopeId","data-v-80975d1a"]]);export{ke as default};
