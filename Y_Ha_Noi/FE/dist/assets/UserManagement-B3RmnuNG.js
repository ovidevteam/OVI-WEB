import{_ as ee,r as u,a as ae,z as le,B as te,c as b,b as E,d as l,W as ne,w as t,j as i,Y as se,q as ue,E as re,Z as oe,A as g,a0 as ie,f as de,D as me,o as r,p as d,h as pe,i as ge,a4 as ce,C as ve,J as w,K as N,aG as K,L as fe,aH as be,N as he,Q as Ve,x as $,aI as ye,aJ as _e,aK as ke,X as Ee,aL as O,y as C}from"./index-BgKCwKch.js";/* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                        *//* empty css                    */import{u as h}from"./userService-ddP0jTFG.js";import{d as we}from"./departmentService-BzlNGIw4.js";const Ne={class:"user-management"},Ce={class:"content-card"},Te={class:"content-card-header"},Ue={class:"pagination-wrapper"},Se={__name:"UserManagement",setup(Ie){const T=u(!1),U=u(!1),S=u([]),I=u([]),x=u(0),V=u(1),A=u(20),L=u(""),R=u(""),D=u(""),c=u(!1),M=u(null),n=ae({id:null,username:"",fullName:"",email:"",password:"",role:"HANDLER",departmentId:null}),v=le(()=>!!n.id),j={username:[{required:!0,message:"Vui lòng nhập username",trigger:"blur"},{min:6,max:20,message:"Username phải từ 6-20 ký tự",trigger:"blur"}],fullName:[{required:!0,message:"Vui lòng nhập họ tên",trigger:"blur"}],email:[{required:!0,message:"Vui lòng nhập email",trigger:"blur"},{type:"email",message:"Email không hợp lệ",trigger:"blur"}],password:[{required:!0,message:"Vui lòng nhập mật khẩu",trigger:"blur"},{min:8,message:"Mật khẩu phải có ít nhất 8 ký tự",trigger:"blur"}],role:[{required:!0,message:"Vui lòng chọn vai trò",trigger:"change"}]},y=async()=>{T.value=!0;try{const s=await h.getList({keyword:L.value,role:R.value,status:D.value,page:V.value,size:A.value});S.value=s.data||[],x.value=s.total||0}catch{S.value=[{id:1,username:"admin",fullName:"Quản trị viên",email:"admin@bvyhanoi.vn",role:"ADMIN",departmentName:"",status:"ACTIVE"},{id:2,username:"leader",fullName:"Nguyễn Văn Lãnh đạo",email:"leader@bvyhanoi.vn",role:"LEADER",departmentName:"",status:"ACTIVE"},{id:3,username:"receiver",fullName:"Trần Thị Tiếp nhận",email:"receiver@bvyhanoi.vn",role:"RECEIVER",departmentName:"Tiếp nhận",status:"ACTIVE"},{id:4,username:"handler1",fullName:"BS. Nguyễn Văn A",email:"handler1@bvyhanoi.vn",role:"HANDLER",departmentName:"Nội khoa",status:"ACTIVE"}],x.value=4}finally{T.value=!1}},F=async()=>{try{I.value=await we.getActiveList()}catch{I.value=[{id:1,name:"Nội khoa"},{id:2,name:"Ngoại khoa"}]}},B=()=>{V.value=1,y()},z=(s=null)=>{s?Object.assign(n,{...s,password:""}):Object.assign(n,{id:null,username:"",fullName:"",email:"",password:"",role:"HANDLER",departmentId:null}),c.value=!0},Q=async()=>{if(M.value)try{await M.value.validate(),U.value=!0,v.value?await h.update(n.id,n):await h.create(n),C.success(v.value?"Cập nhật thành công!":"Thêm mới thành công!"),c.value=!1,y()}catch(s){s!==!1&&C.error("Có lỗi xảy ra")}finally{U.value=!1}},X=async s=>{try{await O.confirm(`Reset mật khẩu cho user "${s.username}"?`,"Xác nhận",{type:"warning"}),await h.resetPassword(s.id),C.success("Đã reset mật khẩu!")}catch{}},J=async s=>{const a=s.status==="ACTIVE"?"khóa":"mở khóa";try{await O.confirm(`Bạn có chắc chắn muốn ${a} user "${s.username}"?`,"Xác nhận",{type:"warning"}),await h.toggleStatus(s.id),C.success(`Đã ${a} user!`),y()}catch{}};return te(()=>{y(),F()}),(s,a)=>{const p=ue,f=ge,o=pe,_=fe,k=ve,H=re,m=he,P=Ve,G=me,W=ie,Y=de,Z=oe;return r(),b("div",Ne,[E("div",Ce,[E("div",Te,[a[15]||(a[15]=E("h3",{class:"content-card-title"},"Quản lý User",-1)),l(p,{type:"primary",icon:i(se),onClick:a[0]||(a[0]=e=>z())},{default:t(()=>[...a[14]||(a[14]=[d(" Thêm mới ",-1)])]),_:1},8,["icon"])]),l(H,{inline:!0,class:"filter-form"},{default:t(()=>[l(o,null,{default:t(()=>[l(f,{modelValue:L.value,"onUpdate:modelValue":a[1]||(a[1]=e=>L.value=e),placeholder:"Tìm theo tên, username...","prefix-icon":i(ce),clearable:"",style:{width:"250px"},onInput:B},null,8,["modelValue","prefix-icon"])]),_:1}),l(o,null,{default:t(()=>[l(k,{modelValue:R.value,"onUpdate:modelValue":a[2]||(a[2]=e=>R.value=e),placeholder:"Vai trò",clearable:"",onChange:B},{default:t(()=>[(r(!0),b(w,null,N(i(K),e=>(r(),g(_,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(o,null,{default:t(()=>[l(k,{modelValue:D.value,"onUpdate:modelValue":a[3]||(a[3]=e=>D.value=e),placeholder:"Trạng thái",clearable:"",onChange:B},{default:t(()=>[(r(!0),b(w,null,N(i(be),e=>(r(),g(_,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),ne((r(),g(G,{data:S.value,stripe:""},{default:t(()=>[l(m,{prop:"username",label:"Username",width:"140"}),l(m,{prop:"fullName",label:"Họ tên","min-width":"180"}),l(m,{prop:"email",label:"Email","min-width":"200"}),l(m,{prop:"role",label:"Vai trò",width:"130",align:"center"},{default:t(({row:e})=>[l(P,{size:"small"},{default:t(()=>[d($(i(ye)(e.role)),1)]),_:2},1024)]),_:1}),l(m,{prop:"departmentName",label:"Phòng ban",width:"150"}),l(m,{prop:"status",label:"Trạng thái",width:"120",align:"center"},{default:t(({row:e})=>[l(P,{type:i(_e)(e.status),size:"small"},{default:t(()=>[d($(i(ke)(e.status)),1)]),_:2},1032,["type"])]),_:1}),l(m,{label:"Thao tác",width:"180",align:"center",fixed:"right"},{default:t(({row:e})=>[l(p,{type:"primary",link:"",onClick:q=>z(e)},{default:t(()=>[...a[16]||(a[16]=[d("Sửa",-1)])]),_:1},8,["onClick"]),l(p,{type:"warning",link:"",onClick:q=>X(e)},{default:t(()=>[...a[17]||(a[17]=[d("Reset MK",-1)])]),_:1},8,["onClick"]),l(p,{type:e.status==="ACTIVE"?"danger":"success",link:"",onClick:q=>J(e)},{default:t(()=>[d($(e.status==="ACTIVE"?"Khóa":"Mở"),1)]),_:2},1032,["type","onClick"])]),_:1})]),_:1},8,["data"])),[[Z,T.value]]),E("div",Ue,[l(W,{"current-page":V.value,"onUpdate:currentPage":a[4]||(a[4]=e=>V.value=e),"page-size":A.value,"onUpdate:pageSize":a[5]||(a[5]=e=>A.value=e),total:x.value,layout:"total, prev, pager, next"},null,8,["current-page","page-size","total"])])]),l(Y,{modelValue:c.value,"onUpdate:modelValue":a[13]||(a[13]=e=>c.value=e),title:v.value?"Sửa User":"Thêm User",width:"500px","close-on-click-modal":!1},{footer:t(()=>[l(p,{onClick:a[12]||(a[12]=e=>c.value=!1)},{default:t(()=>[...a[18]||(a[18]=[d("Hủy",-1)])]),_:1}),l(p,{type:"primary",loading:U.value,onClick:Q},{default:t(()=>[...a[19]||(a[19]=[d("Lưu",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(H,{ref_key:"formRef",ref:M,model:n,rules:j,"label-width":"100px"},{default:t(()=>[l(o,{label:"Username",prop:"username"},{default:t(()=>[l(f,{modelValue:n.username,"onUpdate:modelValue":a[6]||(a[6]=e=>n.username=e),disabled:v.value},null,8,["modelValue","disabled"])]),_:1}),l(o,{label:"Họ tên",prop:"fullName"},{default:t(()=>[l(f,{modelValue:n.fullName,"onUpdate:modelValue":a[7]||(a[7]=e=>n.fullName=e)},null,8,["modelValue"])]),_:1}),l(o,{label:"Email",prop:"email"},{default:t(()=>[l(f,{modelValue:n.email,"onUpdate:modelValue":a[8]||(a[8]=e=>n.email=e),type:"email"},null,8,["modelValue"])]),_:1}),v.value?Ee("",!0):(r(),g(o,{key:0,label:"Mật khẩu",prop:"password"},{default:t(()=>[l(f,{modelValue:n.password,"onUpdate:modelValue":a[9]||(a[9]=e=>n.password=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1})),l(o,{label:"Vai trò",prop:"role"},{default:t(()=>[l(k,{modelValue:n.role,"onUpdate:modelValue":a[10]||(a[10]=e=>n.role=e),style:{width:"100%"}},{default:t(()=>[(r(!0),b(w,null,N(i(K),e=>(r(),g(_,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(o,{label:"Phòng ban"},{default:t(()=>[l(k,{modelValue:n.departmentId,"onUpdate:modelValue":a[11]||(a[11]=e=>n.departmentId=e),placeholder:"Chọn phòng ban",clearable:"",style:{width:"100%"}},{default:t(()=>[(r(!0),b(w,null,N(I.value,e=>(r(),g(_,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},He=ee(Se,[["__scopeId","data-v-5e12a077"]]);export{He as default};
