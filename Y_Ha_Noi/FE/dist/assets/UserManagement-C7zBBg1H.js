import{_ as le,r as o,a as ae,A as te,C as ne,c as b,b as y,d as a,a1 as se,w as t,j as i,a3 as oe,q as ue,E as re,a4 as ie,B as g,a6 as de,f as me,aL as O,aM as pe,G as ge,o as u,p as d,h as ce,i as fe,aa as ve,F as be,P as k,Q as w,aN as F,R as _e,aO as Ve,T as he,W as ye,x as I,aP as ke,aQ as we,aR as Ee,a2 as Ue,aS as j,y as E}from"./index-WXSJfKjD.js";/* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                        *//* empty css                    */import{u as U}from"./userService-DXWIgT-v.js";import{d as Ce}from"./departmentService-CYi6ROd7.js";const Se={class:"user-management"},Te={class:"content-card"},xe={class:"content-card-header"},Ne={class:"pagination-wrapper"},Re={__name:"UserManagement",setup(Ie){const C=o(!1),S=o(!1),L=o([]),T=o([]),M=o(0),x=o(1),D=o(20),P=o(""),$=o(""),A=o(""),c=o(!1),N=o(null),n=ae({id:null,username:"",fullName:"",email:"",password:"",role:"HANDLER",departmentId:null}),f=te(()=>!!n.id),K={username:[{required:!0,message:"Vui lòng nhập username",trigger:"blur"},{min:6,max:20,message:"Username phải từ 6-20 ký tự",trigger:"blur"}],fullName:[{required:!0,message:"Vui lòng nhập họ tên",trigger:"blur"}],email:[{required:!0,message:"Vui lòng nhập email",trigger:"blur"},{type:"email",message:"Email không hợp lệ",trigger:"blur"}],password:[{required:!0,message:"Vui lòng nhập mật khẩu",trigger:"blur"},{min:8,message:"Mật khẩu phải có ít nhất 8 ký tự",trigger:"blur"}],role:[{required:!0,message:"Vui lòng chọn vai trò",trigger:"change"}]},_=async()=>{C.value=!0;{L.value=[...O],M.value=O.length,C.value=!1;return}},Q=async()=>{try{T.value=await Ce.getActiveList()}catch{T.value=[...pe]}},R=()=>{x.value=1,_()},B=(s=null)=>{s?Object.assign(n,{...s,password:""}):Object.assign(n,{id:null,username:"",fullName:"",email:"",password:"",role:"HANDLER",departmentId:null}),c.value=!0},X=async()=>{if(N.value)try{await N.value.validate(),S.value=!0,f.value?await U.update(n.id,n):await U.create(n),E.success(f.value?"Cập nhật thành công!":"Thêm mới thành công!"),c.value=!1,_()}catch(s){s!==!1&&E.error("Có lỗi xảy ra")}finally{S.value=!1}},G=async s=>{try{await j.confirm(`Reset mật khẩu cho user "${s.username}"?`,"Xác nhận",{type:"warning"}),await U.resetPassword(s.id),E.success("Đã reset mật khẩu!")}catch{}},W=async s=>{const l=s.status==="ACTIVE"?"khóa":"mở khóa";try{await j.confirm(`Bạn có chắc chắn muốn ${l} user "${s.username}"?`,"Xác nhận",{type:"warning"}),await U.toggleStatus(s.id),E.success(`Đã ${l} user!`),_()}catch{}};return ne(()=>{_(),Q()}),(s,l)=>{const p=ue,v=fe,r=ce,V=_e,h=be,q=re,m=he,z=ye,J=ge,Y=de,Z=me,ee=ie;return u(),b("div",Se,[y("div",Te,[y("div",xe,[l[15]||(l[15]=y("h3",{class:"content-card-title"},"Quản lý User",-1)),a(p,{type:"primary",icon:i(oe),onClick:l[0]||(l[0]=e=>B())},{default:t(()=>[...l[14]||(l[14]=[d(" Thêm mới ",-1)])]),_:1},8,["icon"])]),a(q,{inline:!0,class:"filter-form"},{default:t(()=>[a(r,null,{default:t(()=>[a(v,{modelValue:P.value,"onUpdate:modelValue":l[1]||(l[1]=e=>P.value=e),placeholder:"Tìm theo tên, username...","prefix-icon":i(ve),clearable:"",style:{width:"250px"},onInput:R},null,8,["modelValue","prefix-icon"])]),_:1}),a(r,null,{default:t(()=>[a(h,{modelValue:$.value,"onUpdate:modelValue":l[2]||(l[2]=e=>$.value=e),placeholder:"Vai trò",clearable:"",onChange:R},{default:t(()=>[(u(!0),b(k,null,w(i(F),e=>(u(),g(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(r,null,{default:t(()=>[a(h,{modelValue:A.value,"onUpdate:modelValue":l[3]||(l[3]=e=>A.value=e),placeholder:"Trạng thái",clearable:"",onChange:R},{default:t(()=>[(u(!0),b(k,null,w(i(Ve),e=>(u(),g(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),se((u(),g(J,{data:L.value,stripe:""},{default:t(()=>[a(m,{prop:"username",label:"Username",width:"140"}),a(m,{prop:"fullName",label:"Họ tên","min-width":"180"}),a(m,{prop:"email",label:"Email","min-width":"200"}),a(m,{prop:"role",label:"Vai trò",width:"130",align:"center"},{default:t(({row:e})=>[a(z,{size:"small"},{default:t(()=>[d(I(i(ke)(e.role)),1)]),_:2},1024)]),_:1}),a(m,{prop:"departmentName",label:"Phòng ban",width:"150"}),a(m,{prop:"status",label:"Trạng thái",width:"120",align:"center"},{default:t(({row:e})=>[a(z,{type:i(we)(e.status),size:"small"},{default:t(()=>[d(I(i(Ee)(e.status)),1)]),_:2},1032,["type"])]),_:1}),a(m,{label:"Thao tác",width:"180",align:"center",fixed:"right"},{default:t(({row:e})=>[a(p,{type:"primary",link:"",onClick:H=>B(e)},{default:t(()=>[...l[16]||(l[16]=[d("Sửa",-1)])]),_:1},8,["onClick"]),a(p,{type:"warning",link:"",onClick:H=>G(e)},{default:t(()=>[...l[17]||(l[17]=[d("Reset MK",-1)])]),_:1},8,["onClick"]),a(p,{type:e.status==="ACTIVE"?"danger":"success",link:"",onClick:H=>W(e)},{default:t(()=>[d(I(e.status==="ACTIVE"?"Khóa":"Mở"),1)]),_:2},1032,["type","onClick"])]),_:1})]),_:1},8,["data"])),[[ee,C.value]]),y("div",Ne,[a(Y,{"current-page":x.value,"onUpdate:currentPage":l[4]||(l[4]=e=>x.value=e),"page-size":D.value,"onUpdate:pageSize":l[5]||(l[5]=e=>D.value=e),total:M.value,layout:"total, prev, pager, next"},null,8,["current-page","page-size","total"])])]),a(Z,{modelValue:c.value,"onUpdate:modelValue":l[13]||(l[13]=e=>c.value=e),title:f.value?"Sửa User":"Thêm User",width:"500px","close-on-click-modal":!1},{footer:t(()=>[a(p,{onClick:l[12]||(l[12]=e=>c.value=!1)},{default:t(()=>[...l[18]||(l[18]=[d("Hủy",-1)])]),_:1}),a(p,{type:"primary",loading:S.value,onClick:X},{default:t(()=>[...l[19]||(l[19]=[d("Lưu",-1)])]),_:1},8,["loading"])]),default:t(()=>[a(q,{ref_key:"formRef",ref:N,model:n,rules:K,"label-width":"100px"},{default:t(()=>[a(r,{label:"Username",prop:"username"},{default:t(()=>[a(v,{modelValue:n.username,"onUpdate:modelValue":l[6]||(l[6]=e=>n.username=e),disabled:f.value},null,8,["modelValue","disabled"])]),_:1}),a(r,{label:"Họ tên",prop:"fullName"},{default:t(()=>[a(v,{modelValue:n.fullName,"onUpdate:modelValue":l[7]||(l[7]=e=>n.fullName=e)},null,8,["modelValue"])]),_:1}),a(r,{label:"Email",prop:"email"},{default:t(()=>[a(v,{modelValue:n.email,"onUpdate:modelValue":l[8]||(l[8]=e=>n.email=e),type:"email"},null,8,["modelValue"])]),_:1}),f.value?Ue("",!0):(u(),g(r,{key:0,label:"Mật khẩu",prop:"password"},{default:t(()=>[a(v,{modelValue:n.password,"onUpdate:modelValue":l[9]||(l[9]=e=>n.password=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1})),a(r,{label:"Vai trò",prop:"role"},{default:t(()=>[a(h,{modelValue:n.role,"onUpdate:modelValue":l[10]||(l[10]=e=>n.role=e),style:{width:"100%"}},{default:t(()=>[(u(!0),b(k,null,w(i(F),e=>(u(),g(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(r,{label:"Phòng ban"},{default:t(()=>[a(h,{modelValue:n.departmentId,"onUpdate:modelValue":l[11]||(l[11]=e=>n.departmentId=e),placeholder:"Chọn phòng ban",clearable:"",style:{width:"100%"}},{default:t(()=>[(u(!0),b(k,null,w(T.value,e=>(u(),g(V,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},He=le(Re,[["__scopeId","data-v-676a9071"]]);export{He as default};
